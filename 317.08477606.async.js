"use strict";(self.webpackChunkexample=self.webpackChunkexample||[]).push([[317],{8317:function(pt,De,C){C.r(De),C.d(De,{CCField:function(){return Ae},CCForm:function(){return I},CCList:function(){return pe},CCListAction:function(){return Ne},CCListView:function(){return ae},CCOutlet:function(){return ye},CCOutletView:function(){return Re}});var we=C(3769),Ee=C.n(we),je=C(5009),M=C.n(je),Me=C(4599),w=C.n(Me),qe=C(9289),z=C.n(qe),Pe=C(7857),T=C.n(Pe),We=C(5574),Ge=C.n(We),Be=C(2444),ne=C.n(Be),He=C(2004),ie=C.n(He),ze=C(5098),b=C.n(ze),Ze=C(1996),se=C.n(Ze),Ke=C(6037),oe=C.n(Ke),Xe=C(9783),y=C.n(Xe),k=C(7294),Je={visible:!0},ue=(0,k.createContext)(null),Q=(0,k.createContext)(null),Y=(0,k.createContext)(null),ke=(0,k.createContext)(Je),Qe=C(9632),Oe=C.n(Qe),_=function(c){return{subData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.subData(n)},validate:function(){var n;return(n=c.current)===null||n===void 0?void 0:n.validate()},asyncValidate:function(){var f=z()(M()().mark(function e(){var t;return M()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(t=c.current)===null||t===void 0?void 0:t.asyncValidate();case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},e)}));function n(){return f.apply(this,arguments)}return n}(),validateErrors:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.validateErrors(n)},asyncValidateErrors:function(){var f=z()(M()().mark(function e(t){var r;return M()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",(r=c.current)===null||r===void 0?void 0:r.asyncValidateErrors(t));case 1:case"end":return i.stop()}},e)}));function n(e){return f.apply(this,arguments)}return n}(),setOriginData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.setOriginData(n)},setFieldData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.setFieldData(n)},addData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.addData(n)},setData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.setData(n)},__REF__:c}},le=function(c){return{add:function(n,e){var t;return(t=c.current)===null||t===void 0?void 0:t.addItem(n,e)},remove:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.removeItem(n)},move:function(n,e){var t;return(t=c.current)===null||t===void 0?void 0:t.moveItem(n,e)},setData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.setData(n)},getData:function(){var n;return(n=c.current)===null||n===void 0?void 0:n.getData()},getSize:function(){var n;return((n=c.current)===null||n===void 0?void 0:n.getData().length)||0},__REF__:c}},Ye=function(){return _((0,k.createRef)())},_e=function(){var c=(0,k.useRef)(null);return[(0,k.useMemo)(function(){return _(c)},[])]},et=function(){var c=(0,k.useContext)(ue),f=c.formInstance,n=(0,k.useRef)(f);return n.current=f,(0,k.useMemo)(function(){return _(n)},[])},tt=function(){return le((0,k.createRef)())},rt=function(){var c=(0,k.useRef)(null);return[(0,k.useMemo)(function(){return le(c)},[])]},at=function(){var c=(0,k.useContext)(Q),f=c.listInstance,n=(0,k.useRef)(f);return n.current=f,(0,k.useMemo)(function(){return le(n)},[])},W=C(865);function ee(o){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,f=null,n=null,e=function(r){n=r,f&&clearTimeout(f),f=setTimeout(function(){f=null,n&&n()},c)};return(0,W.N7)(o,{scheduler:e})}var nt=C(2677),ve=C.n(nt),X=Object.prototype.toString;function B(o){return typeof o=="function"}function yt(o){return typeof o=="number"||X.call(o)==="[object Number]"}function te(o){return typeof o=="string"||X.call(o)==="[object String]"}function it(o){return typeof o=="boolean"||X.call(o)==="[object Boolean]"}function A(o){return ve()(o)==="object"&&X.call(o)==="[object Object]"}function Ie(o){return ve()(o)==="object"&&(X.call(o)==="[object Promise]"||Promise.resolve(o)===o)}function V(o){return Array.isArray(o)}function Z(o){return typeof o=="undefined"}function st(o){return o===null}function O(o){return Z(o)||st(o)}function D(o){return O(o)||!String(o).trim().length}function de(o){return O(o)||!A(o)||!Object.getOwnPropertyNames(o).length}function re(o){return O(o)||!V(o)||!o.length}function fe(o,c){var f=0;return o.indexOf("[")!==-1?o.replace(/(\w)\[+([\w.\s]*)]+/g,function(n,e,t){var r="[".concat(t.replace(/\./g,"_"),"_").concat(++f,"]");return t.indexOf(".")!==-1?(c[r]=t,"".concat(e,".").concat(r)):"".concat(e,".").concat(t)}):o}function ce(o,c,f){if(O(o)||D(c))return f;if(A(o)||V(o)){var n=o,e={};if(c in o)n=o[c];else{var t=fe(c,e).split("."),r=w()(t),a;try{for(r.s();!(a=r.n()).done;){var i=a.value;if(n=i in e?n[e[i]]:n[i],!n)break}}catch(s){r.e(s)}finally{r.f()}}return O(n)?f:n}else return o}function K(o,c,f){if(O(o)||D(c))return f;if(A(o)||V(o)){var n=o,e={};if(c in o)n=o[c];else for(var t=fe(String(c),e).split("."),r=0,a=t.length;r<a;r++){var i=t[r];if(A(n)||V(n)){var s=t.slice(r).join(".");if(s in n){n=s in e?n[e[s]]:n[s];break}}if(n=i in e?n[e[i]]:n[i],!n)break}return Z(n)?f:n}else return o}function ot(o,c){var f=Object.create(null);(c||[]).forEach(function(e){var t=e.form,r=e.transform,a=e.inline,i=a===void 0?!0:a,s=ut(o[t]);if(B(r)?s=i&&V(s)?s.map(function(h,m){return r(h,o,m)}):r(s,o):D(r)||(s=i&&V(s)?s.map(function(h){return ce(h,r)}):ce(s,r)),t=t.replace(/@\w*/g,""),i)he(f,t,s);else{var u=t.lastIndexOf(".");if(u!==-1){var l=t.substr(0,u),d=t.substr(u+1),v=ce(f,l);s=A(s)?s:y()({},d,s),V(v)?s=v.push(s):A(v)&&(s=Object.assign(v,s)),he(f,l,s)}else A(s)?Object.assign(f,s):f[t]=s}});var n=Object.keys(f);return n.every(function(e){return/^([1-9]\d*|0)$/.test(e)})&&(f.length=n.length,f=Array.from(f).filter(function(e){return!O(e)})),f}function he(o,c,f){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},e=n.ks,t=e===void 0?{}:e,r=fe(c,t),a=r.indexOf(".");if(~a){var i=r.split("."),s=i[0],u=i.slice(1).join("."),l=o[s]||(u[0]==="0"?[]:Object.create(null)),d=he(l,u,f,T()({ks:t},n));l!==o[s]&&(o[s in t?t[s]:s]=d)}else(!V(o)||!O(f))&&(o[c in t?t[c]:c]=f);return o}function ut(o){return(0,W.bi)(o)?V(o)?Array.from(o):Object.assign({},o):o}function lt(o,c){return c&&c.target&&ve()(c.target)==="object"&&o in c.target?c.target[o]:c}function $e(o,c){return V(c)&&V(o)?c.some(function(f,n){return f!==o[n]}):c!==o}var N=C(5893),J;(function(o){o[o.Field=1]="Field",o[o.List=2]="List"})(J||(J={}));var G;(function(o){o[o.DEFAULT=0]="DEFAULT",o[o.SET=1]="SET"})(G||(G={}));function Le(o){return o.fieldType===J.Field}var I=function(o){se()(f,o);var c=oe()(f);function f(n){var e;ne()(this,f),e=c.call(this,n),y()(b()(e),"originData",void 0),y()(b()(e),"fieldStatus",W.LO({})),y()(b()(e),"changeState",G.DEFAULT),y()(b()(e),"fields",new Set),y()(b()(e),"fieldsMap",new Map),y()(b()(e),"removeFields",new Set),y()(b()(e),"updateFields",new Set),y()(b()(e),"listFields",new Set),y()(b()(e),"providerValue",{}),y()(b()(e),"timeoutChange",void 0),y()(b()(e),"timeoutErrorChange",void 0),y()(b()(e),"tempFields",void 0),y()(b()(e),"autoRunTime",void 0),y()(b()(e),"errorsMap",new Map);var t=b()(e),r=n.emitter,a=n.form;return t.state={data:W.LO({}),originData:{}},t.providerValue={formInstance:t,emitter:r},a&&a.__REF__&&(a.__REF__.current=t),e}return ie()(f,[{key:"componentWillUnmount",value:function(){this.unObserveField()}},{key:"shouldComponentUpdate",value:function(e,t){var r=this;return t.data!==r.state.data||e.children!==r.props.children||e.disabled!==r.props.disabled}},{key:"getSnapshotBeforeUpdate",value:function(e,t){var r=this;return t.data!==r.state.data&&(r.unObserveField(),r.revertField(),r.revertListField()),null}},{key:"componentDidUpdate",value:function(e,t){var r=this;r.changeState=G.DEFAULT,t.data!==r.state.data&&r.observeField()}},{key:"revertListField",value:function(){var e=w()(this.listFields),t;try{for(e.s();!(t=e.n()).done;){var r=t.value,a=r.initState();r.removeOutData(a.data.length),r.setState(a)}}catch(i){e.e(i)}finally{e.f()}}},{key:"revertField",value:function(){var e=this,t=w()(e.fields),r;try{for(t.s();!(r=t.n()).done;){var a=r.value,i=a.initState(),s=a.getFormName();!D(s)&&!(s in e.state.data)&&e._setFieldValue(s,i.value,{raw:!0}),a.setState(i)}}catch(u){t.e(u)}finally{t.f()}}},{key:"unObserveField",value:function(){var e=w()(this.fields),t;try{for(e.s();!(t=e.n()).done;){var r=t.value;r.unObserveData()}}catch(a){e.e(a)}finally{e.f()}}},{key:"observeField",value:function(){var e=w()(this.fields),t;try{for(e.s();!(t=e.n()).done;){var r=t.value;r.observeData()}}catch(a){e.e(a)}finally{e.f()}}},{key:"fieldAutoRun",value:function(){var e=w()(this.updateFields),t;try{for(e.s();!(t=e.n()).done;){var r=t.value;r.observeData()}}catch(a){e.e(a)}finally{e.f()}this.updateFields.clear()}},{key:"handleChange",value:function(e){var t,r,a=this;(t=(r=a.props).onChange)===null||t===void 0||t.call(r,a.state.originData,e),a.changeState=G.DEFAULT}},{key:"fieldChange",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=this,i=r.raw,s=i===void 0?!1:i;D(e)||a.state.data[e]===t||(a._setFieldValue(e,t,{raw:s}),a.formChange(e))}},{key:"deleteField",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this,a=t.isChange,i=a===void 0?!0:a;O(e)||(delete W.LZ(r.state.data)[e],delete r.state.originData[e],i&&r.formChange(e))}},{key:"formChange",value:function(e){var t,r=this;clearTimeout(r.timeoutChange);var a=!D(e)&&((t=r.getField(e))===null||t===void 0?void 0:t.props);r.tempFields=r.tempFields||[],a&&r.tempFields.push(a),r.timeoutChange=setTimeout(function(){r.handleChange(r.tempFields),r.tempFields=[]})}},{key:"errorsChange",value:function(e,t){var r=this,a=r.props.onErrorChange;r.errorsMap.set(e,{key:e,messages:t}),a&&(clearTimeout(r.timeoutErrorChange),r.timeoutErrorChange=setTimeout(function(){var i=[];r.errorsMap.forEach(function(s){var u;(u=s.messages)!==null&&u!==void 0&&u.length&&i.push(s)}),a(i)}))}},{key:"_setFieldValue",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=r.raw,i=a===void 0?!1:a;if(!D(e)){var s=this.state.data;(i?W.LZ(s):s)[e]=t,this.state.originData[e]=t}}},{key:"setFieldStatus",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=r.raw,i=a===void 0?!1:a;if(!D(e)){var s=t.disabled,u=t.required,l=t.error,d=t.visible;(i?W.LZ(this.fieldStatus):this.fieldStatus)[e]={disabled:s,visible:d,required:u,validate:O(l)?void 0:!l}}}},{key:"setField",value:function(e){var t=this;if(Le(e)){var r=e.getFormName();D(r)||t.fieldsMap.set(r,e),t.fields.add(e),t._setFieldValue(r,e.value,{raw:!0}),t.setFieldStatus(r,e.getConfig(),{raw:!0}),t.updateFields.add(e),clearTimeout(t.autoRunTime),t.autoRunTime=setTimeout(function(){return t.fieldAutoRun()})}else t.listFields.add(e)}},{key:"renameField",value:function(e,t){this.fieldsMap.set(e,t)}},{key:"getField",value:function(e){return D(e)?null:this.fieldsMap.get(e)}},{key:"unmountField",value:function(e){var t=this;if(Le(e)){var r=e.getFormName();e.unObserveData(),t.fields.delete(e),t.removeFields.add(e),!D(r)&&t.fieldsMap.delete(r)}else t.listFields.delete(e)}},{key:"setOriginData",value:function(e){var t=this;t.originData=e;var r=w()(t.listFields),a;try{for(r.s();!(a=r.n()).done;){var i=a.value,s=i.getConfig(),u=s.form;if(D(u))V(e)&&i.setData(e);else{var l=K(e,String(u));l&&i.setData(l)}}}catch(d){r.e(d)}finally{r.f()}t.setData(e,{isGet:!0,isChange:!1})}},{key:"setFieldData",value:function(e){this.setData(e,{isGet:!0,isChange:!0})}},{key:"setData",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this;if(!O(e)){var a=t.isGet,i=a===void 0?!1:a,s=t.isChange,u=s===void 0?!1:s;r.changeState=G.SET;var l=0,d=function(){setTimeout(function(){l--,l<=0&&(r.changeState=G.DEFAULT)})},v=w()(r.fields),h;try{for(v.s();!(h=v.n()).done;){var m=h.value,p=m.getConfig(),F=p.form,g=p.convertValue,L=p.alias;if(F){for(var E=Symbol(),$=E,S=0,R=[F].concat(Oe()(L));S<R.length;S++){var j=R[S],x=K(e,j,E);x!==E&&($=x,F=j)}if(E===$)continue;$=i&&B(g)?m.execGetValue(F,$,e):$,l++,u?m.handleChange($,d):m.setValue($,d)}}}catch(q){v.e(q)}finally{v.f()}l===0&&(r.changeState=G.DEFAULT)}}},{key:"addData",value:function(e){for(var t in e)e.hasOwnProperty(t)&&this._setFieldValue(t,e[t])}},{key:"validate",value:function(){return this.validateErrors().length===0}},{key:"asyncValidate",value:function(){var n=z()(M()().mark(function t(){return M()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.asyncValidateErrors();case 2:return a.t0=a.sent.length,a.abrupt("return",a.t0===0);case 4:case"end":return a.stop()}},t,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"validateErrors",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=new Map;return this._validateErrors(t,function(r,a){return a(r.validateErrors())},e),Array.from(t.values())}},{key:"asyncValidateErrors",value:function(){var n=z()(M()().mark(function t(){var r=this,a,i=arguments;return M()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return a=i.length>0&&i[0]!==void 0?i[0]:[],u.abrupt("return",new Promise(function(l){var d=new Map,v=0,h=0,m=r._validateErrors(d,function(p,F){v++,z()(M()().mark(function g(){return M()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.t0=F,E.next=3,p.asyncValidateErrors();case 3:E.t1=E.sent,(0,E.t0)(E.t1),h++,h===v&&l(Array.from(d.values()));case 7:case"end":return E.stop()}},g)}))()},a);!m&&l([])}));case 2:case"end":return u.stop()}},t)}));function e(){return n.apply(this,arguments)}return e}()},{key:"_validateErrors",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=this,i=!1,s=w()(this.fields),u;try{var l=function(){var v=u.value,h=v.getConfig();!D(h.form)&&h.visible&&h.parentVisible&&(!r.length||r.findIndex(function(m){return String(h.form).indexOf(String(m))===0})!==-1)&&(i=!0,t(v,function(m){var p=m.error,F=m.errors,g={key:h.form,messages:F};p&&e.set(h.form,g),a.errorsMap.set(String(h.form),g)}))};for(s.s();!(u=s.n()).done;)l()}catch(d){s.e(d)}finally{s.f()}return i}},{key:"subData",value:function(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=this,a=t.merge,i=a===void 0?!1:a,s=[],u=[],l=r.state,d=l.data,v=l.initialValue,h=w()(r.removeFields),m;try{for(h.s();!(m=h.n()).done;){var p=m.value,F=p.getConfig();F.form&&u.push(F.form)}}catch(P){h.e(P)}finally{h.f()}var g=w()(r.fields),L;try{for(g.s();!(L=g.n()).done;){var E=L.value,$=E.getConfig();$.form&&(u.push($.form),!$.ignore&&$.parentVisible&&$.visible&&s.push($))}}catch(P){g.e(P)}finally{g.f()}var S=ot(d,s);for(var R in d)!~u.indexOf(R)&&!(R in S)&&(S[R]=d[R]);var j=(e=r.originData)!==null&&e!==void 0?e:v;if(i&&j){var x=w()(r.listFields),q;try{var U=function(){var H=q.value,Ce=H.getConfig(),xe=Ce.form,Fe=H.getData(),mt=H.deleteIndex,be=K(S,String(xe));xe&&be&&Fe&&A(Fe[0])&&Fe.forEach(function(gt,Ve){mt.includes(Ve)||(be[Ve]=Object.assign({},gt,be[Ve]))})};for(x.s();!(q=x.n()).done;)U()}catch(P){x.e(P)}finally{x.f()}return Object.assign({},j,S)}return S}},{key:"data",get:function(){return this.state.data}},{key:"render",value:function(){var e=this,t=e.props.disabled,r=t===void 0?!1:t,a=e.state,i=a.data,s=a.originData,u=a.initialValue,l=e.providerValue;return l.data=i,l.originData=s,l.initialValue=u,l.disabled=r,l.fieldStatus=e.fieldStatus,(0,N.jsx)(ue.Provider,{value:l,children:e.props.children})}}],[{key:"getDerivedStateFromProps",value:function(e,t){var r=e.data,a=e.initialValue;return r&&r!==t.originData?{data:W.LO(r),originData:r}:a&&a!==t.initialValue?{data:W.LO({}),originData:{},initialValue:a}:null}}]),f}(k.Component);y()(I,"Context",ue),y()(I,"useForm",_e),y()(I,"useFormInstance",et),y()(I,"useList",rt),y()(I,"useListInstance",at),y()(I,"createForm",Ye),y()(I,"createList",tt),y()(I,"Outlet",void 0),y()(I,"OutletView",void 0),y()(I,"List",void 0),y()(I,"Field",void 0),y()(I,"ListView",void 0),y()(I,"ListAction",void 0);var vt=["forwardRef","__Component__","preserve","title","valuePropName","forValue","parentField","deliver"],Se="id",Ue=!0,dt=!0,Te=!0,ft=!1,ct=!1,me=function(o){se()(f,o);var c=oe()(f);function f(n,e){var t,r;ne()(this,f),r=c.call(this,n,e),y()(b()(r),"formInstance",void 0),y()(b()(r),"changeFlag",!1),y()(b()(r),"changeForm",!1),y()(b()(r),"isObserveUnion",!1),y()(b()(r),"unmount",!1),y()(b()(r),"observeReactions",[]),y()(b()(r),"providerValue",{}),y()(b()(r),"fieldType",J.Field);var a=b()(r);return a.listenerValueChange=a.listenerValueChange.bind(a),a.onChange=a.onChange.bind(a),a.observeVisible=a.observeVisible.bind(a),a.observeDisabled=a.observeDisabled.bind(a),a.observeRequired=a.observeRequired.bind(a),a.formInstance=_({current:(t=e==null?void 0:e.formInstance)!==null&&t!==void 0?t:null}),a.state=a.initState(),a.providerValue={fieldInstance:a},r}return ie()(f,[{key:"initState",value:function(){var e=this,t=e.props,r=e.context,a=t.initialValue,i=t.convertValue,s=t.defaultValue,u=t.visible,l=t.disabled,d=e.getFormName(t),v={},h=Z(a)?s:a;!D(d)&&r&&(r.initialValue&&(v=r.initialValue,h=K(r.initialValue,d,h)),r.data&&d in r.data&&!Z(r.data[d])&&(h=r.data[d]));var m=e.getOptions(),p=m.options,F=m.data,g=e.findRequired(F,p),L=g.required,E=g.message,$={value:B(i)?e.execGetValue(d,h,v):h,initialValue:h,visible:O(u)?!0:!!e.execCallback(u,F,p),disabled:O(l)?!1:!!e.execCallback(l,F,p),required:L,requiredMsg:E,_refreshMark:{}};return e.changeFlag=!1,e.changeForm=!1,e.isObserveUnion=!1,$}},{key:"getFormName",value:function(e){var t=e||this.props,r=t.form,a=t.eachConfig,i=t.injectListName;return a&&i?typeof r!="number"&&r?"".concat(a.form,".").concat(r):a.form:r}},{key:"getFormAlias",value:function(e){var t=e||this.props,r=t.alias,a=t.eachConfig;return D(r)?[]:(r=V(r)?r:[r],r.map(function(i){return a?i?"".concat(a.form,".").concat(i):a.form:i}))}},{key:"findRequired",value:function(e,t){var r=this,a=r.props.rules;if(!O(a)){a=A(a)?[a]:a;var i=function(l){return A(l)&&!!r.execCallback(l.required,e,t)};if(V(a)){var s=a.find(i);return{required:!!(s!=null&&s.required),message:s==null?void 0:s.message}}else return{required:r.execCallback(a,e,t)===!0}}return{required:!1}}},{key:"execGetValue",value:function(e,t,r){var a=this.props,i=a.convertValue,s=a.eachConfig,u=a.inline;if(!u&&!D(e)){var l=String(e),d=s&&s.form?s.form:l.substring(0,l.lastIndexOf(".")),v=D(d)?r:K(r,d);t=v!=null?v:t}try{return i(t)}catch(h){console.warn("ConvertValue:",h)}}},{key:"observeData",value:function(){var e=this;e.unObserveData(),e.observeReactions.push(ee(e.observeVisible),ee(e.observeDisabled),ee(e.observeRequired)),e.observeUnion()}},{key:"unObserveData",value:function(){this.observeReactions.forEach(function(e){return W.p_(e)}),this.observeReactions=[]}},{key:"getOptions",value:function(){var e=this,t=e.props.eachConfig||{},r=t.form,a=t.data,i=e.state||{},s=i.value,u=i.disabled,l=i.visible,d=i.error,v=i.required,h=e.context,m=h.data,p=h.originData,F=h.fieldStatus,g={form:r,val:s,data:p,status:F,selfStatus:{disabled:u,visible:l,required:v,validate:O(d)?void 0:!d},listData:a};return{options:g,data:m,originData:p}}},{key:"observeDisabled",value:function(){var e=this;if(!e.unmount){var t=e.props.disabled,r=e.getOptions(),a=r.options,i=r.data;O(t)||(e.disabled=!!e.execCallback(t,i,a))}}},{key:"observeVisible",value:function(){var e=this;if(!e.unmount){var t=e.props.visible,r=e.getOptions(),a=r.options,i=r.data;O(t)||(e.visible=!!e.execCallback(t,i,a))}}},{key:"observeRequired",value:function(){var e=this;if(!e.unmount){var t=e.getOptions(),r=t.options,a=t.data,i=e.findRequired(a,r),s=i.required,u=i.message;e.required=s,e.requiredMsg=u}}},{key:"observeUnion",value:function(){var e=this;e.isObserveUnion=!1;var t=e.context,r=e.getUnionList();if(!(e.unmount||re(r))){var a=e.props,i=a.unionValue,s=a.unionValidate,u=t.formInstance,l=e.getFormName();i=B(i)?i:function(){return s?e.value:void 0};var d=function v(h){var m,p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],F=((m=u.getField(h))===null||m===void 0?void 0:m.getUnionList())||[];return F.forEach(function(g){var L=V(g)?g[0]:g;p.indexOf(L)===-1&&(p.push(L),v(L,p))}),p};r.forEach(function(v){var h=V(v)?v:[v,i],m=Ge()(h,2),p=m[0],F=m[1],g=d(p,[p]),L=ee(function(){var E=e.getOptions(),$=E.options,S=E.data,R=E.originData,j=e.execCallback(F,S[p],T()(T()({},$),{},{data:R})),x=!1,q=function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},H=P.valid,Ce=H===void 0?!1:H;!e.unmount&&p in S&&e.handleChange(j,function(){Ce&&s&&e.unionValidateErrors()})};e.isObserveUnion&&(u==null?void 0:u.changeState)!==G.SET?(x=!0,q({valid:!0})):g.forEach(function(U){return S[U]}),!x&&O(l)&&q()});e.observeReactions.push(L)}),e.isObserveUnion=!0}}},{key:"getUnionList",value:function(){var e=this,t=e.props.union;if(D(t))return null;var r=e.getOptions(),a=r.options;return t=B(t)?t(a):t,D(t)?null:(t=V(t)?t:t.split(","),t)}},{key:"execCallback",value:function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return B(e)?e.apply(void 0,r):e}catch(i){console.warn(i)}}},{key:"getTitle",value:function(){var e=this,t=e.getOptions(),r=t.options,a=t.data;return e.execCallback(e.props.title,a,r)}},{key:"getConfig",value:function(e,t){var r=this;e=e||r.props,t=t||r.state;var a=e,i=a.inline,s=a.transform,u=a.ignore,l=a.convertValue,d=a.parentField,v=t,h=v.disabled,m=v.visible,p=v.error,F=v.required;return{inline:i,form:r.getFormName(e),alias:r.getFormAlias(e),transform:s,visible:m,parentVisible:d.visible,disabled:h,ignore:u,error:p,required:F,convertValue:l}}},{key:"onChange",value:function(e){var t=this,r=t.props,a=r.normalize,i=r.valuePropName,s=i===void 0?"value":i,u=t.context;e=lt(s,e);for(var l=arguments.length,d=new Array(l>1?l-1:0),v=1;v<l;v++)d[v-1]=arguments[v];t.handleChange(a?a(e,{val:t.state.value,data:u.data,args:d}):e)}},{key:"handleChange",value:function(e,t){var r,a=this;if(a.unmount||e===a.state.value){t==null||t();return}var i=a.context,s=a.props.listener,u=s===void 0?{}:s,l=u.key,d=u.transform;a.changeFlag=!0,a.changeForm=!0,l&&((r=i.emitter)===null||r===void 0||r.emit(l,d?d(e,i.data):e)),a.handleValue(e,t)}},{key:"setValue",value:function(e,t){this.changeForm=!0,this.handleValue(e,t)}},{key:"value",get:function(){return this.state.value}},{key:"handleValue",value:function(e,t){var r=this,a=r.state.value;!r.unmount&&!r.equalsValue(e,a)?r.setState({value:e},t):t==null||t()}},{key:"equalsValue",value:function(e,t){var r=this,a=r.props,i=a.label,s=a.unique,u=s===void 0?Se:s;if(e===t)return!0;var l=function(v,h){if(de(v)||de(h))return!1;var m,p;return u in v||u in h?(m=v[u],p=h[u]):i&&(i in v||i in h)&&(m=v[i],p=h[i]),r.equalsValue(m,p)};return A(e)||A(t)?l(e,t):V(e)||V(t)?re(e)||re(t)||e.length!==t.length?!1:e.every(function(d,v){return r.equalsValue(d,t[v])}):String(e)===String(t)}},{key:"disabled",set:function(e){e!==this.state.disabled&&this.setState({disabled:e})}},{key:"required",set:function(e){e!==this.state.required&&this.setState({required:e})}},{key:"requiredMsg",set:function(e){e!==this.state.requiredMsg&&this.setState({requiredMsg:e})}},{key:"visible",set:function(e){var t=this;e!==t.state.visible&&(e||t.setState({error:void 0,errors:void 0}),t.setState({visible:e}))}},{key:"validateErrors",value:function(){return this._validateErrors(this.validate())}},{key:"asyncValidateErrors",value:function(){return this._asyncValidateErrors()}},{key:"unionValidateErrors",value:function(){return this._asyncValidateErrors({isUnionValid:!0})}},{key:"_asyncValidateErrors",value:function(){var n=z()(M()().mark(function t(){var r,a,i,s,u,l,d,v,h,m,p=arguments;return M()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(r=p.length>0&&p[0]!==void 0?p[0]:{},a=this,i=r.isUnionValid,s=a.validate({async:!0,isUnionValid:i}),!V(s)){g.next=38;break}u=[],l=!0,d=w()(s),g.prev=8,d.s();case 10:if((v=d.n()).done){g.next=29;break}if(h=v.value,!Ie(h)){g.next=26;break}return m=void 0,g.prev=14,g.next=17,h;case 17:m=g.sent,g.next=23;break;case 20:g.prev=20,g.t0=g.catch(14),m=g.t0;case 23:te(m)?u.push(m):m||(l=!1),g.next=27;break;case 26:u.push(h);case 27:g.next=10;break;case 29:g.next=34;break;case 31:g.prev=31,g.t1=g.catch(8),d.e(g.t1);case 34:return g.prev=34,d.f(),g.finish(34);case 37:s=u.length?u:l;case 38:return g.abrupt("return",this._validateErrors(s));case 39:case"end":return g.stop()}},t,this,[[8,31,34,37],[14,20]])}));function e(){return n.apply(this,arguments)}return e}()},{key:"_validateErrors",value:function(e){var t=this,r=t.state,a=r.errors,i=r.error,s,u;return it(e)?(u=!e,s=void 0):(u=!!e.length,s=e),u!==i&&t.setState({error:u}),t.equalsValue(a,s)||t.setState({errors:s,_refreshMark:{}}),{error:u,errors:s}}},{key:"validate",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=this,r=e.async,a=r===void 0?!1:r,i=e.isUnionValid,s=i===void 0?!1:i,u=t.props,l=u.ignore,d=u.rules,v=t.state,h=v.required,m=v.requiredMsg,p=v.value,F=v.visible;if(l&&!h||!F)return!0;var g=s?!1:t.validateEmpty(p);if(h&&g)return D(m)?!1:[m];if(g)return!0;var L=t.getOptions(),E=L.options,$=L.originData,S=function(U){if(B(U))return U($,T()(T()({},E),{},{isUnionValid:s}));if(!s){if(U&&U instanceof RegExp)return U.test(p);if(A(U)){var P=U.pattern,H=U.message;if(P&&!P.test(p))return H||!1}}return!0};if(V(d)){var R=[],j=!0;return d.forEach(function(q){var U=S(q);te(U)||a&&Ie(U)?R.push(U):U||(j=!1)}),R.length?R:j}else if(!s&&A(d)){var x=S(d);return te(x)?[x]:x}return!0}},{key:"validateEmpty",value:function(e){var t=this.props.label,r=function(i){return de(i)||!!(t&&D(i[t]))};return O(e)?!0:te(e)?D(e):A(e)?r(e):V(e)?re(e)||A(e[0])&&r(e[0]):O(e)}},{key:"listenerValueChange",value:function(e){var t=this,r=this.context,a=t.props.listener;t.handleValue(a!=null&&a.convertValue?a.convertValue(e,r.data):e)}},{key:"componentDidMount",value:function(){var e,t=this,r=t.context,a=t.props.listener,i=a===void 0?{}:a,s=i.key;s&&((e=r.emitter)===null||e===void 0||e.addListener(s,t.listenerValueChange)),r.formInstance.setField(t)}},{key:"componentWillUnmount",value:function(){var e,t=this;t.unmount=!0;var r=t.context,a=t.props.listener,i=a===void 0?{}:a,s=i.key;s&&((e=r.emitter)===null||e===void 0||e.removeListener(s,t.listenerValueChange)),r.formInstance.unmountField(t)}},{key:"shouldComponentUpdate",value:function(e,t){var r=this,a=r.props,i=r.state;return t.value!==i.value||t.required!==i.required||t.error!==i.error||t.visible!==i.visible||t.disabled!==i.disabled||t._refreshMark!==i._refreshMark||e.form!==a.form||r.getFormName(e)!==r.getFormName(a)||$e(a.shouldUpdate,e.shouldUpdate)}},{key:"getSnapshotBeforeUpdate",value:function(e,t){var r=this,a=this.context,i=a.formInstance,s=r.state,u=s.required,l=s.error,d=s.visible,v=s.disabled,h=r.getFormName(r.props),m=r.getFormName(e);return e.form!==this.props.form&&i.unmountField(this),h!==m&&!D(h)&&i.renameField(h,r),(u!==t.required||l!==t.error||d!==t.visible||v!==t.disabled)&&i.setFieldStatus(h,{required:u,error:l,visible:d,disabled:v}),null}},{key:"componentDidUpdate",value:function(e,t){var r=this,a=this.context,i=a.formInstance,s=r.state,u=s.value,l=s.required,d=s.error,v=s.errors,h=r.getFormName(r.props);if(u!==t.value){var m,p;i.fieldChange(h,u,{raw:!r.changeForm}),r.changeFlag&&((m=(p=r.props).onChange)===null||m===void 0||m.call(p,u))}(u!==t.value&&r.changeFlag||l!==t.required&&!l&&!O(d))&&r.asyncValidateErrors(),e.form!==r.props.form&&i.setField(r),h!==r.getFormName(e)&&i.fieldChange(h,u,{raw:!0}),!D(h)&&v!==t.errors&&i.errorsChange(String(h),v),r.changeFlag=!1,r.changeForm=!1}},{key:"render",value:function(){var e=this,t=e.context,r=e.state,a=r.value,i=r.required,s=r.error,u=r.errors,l=r.disabled,d=r.visible,v=e.props,h=v.forwardRef,m=v.__Component__,p=v.preserve,F=v.title,g=v.valuePropName,L=v.forValue,E=v.parentField,$=v.deliver,S=Ee()(v,vt);if(!d&&!p)return null;var R=L?L(a,t.data):a;g&&(S[g]=R);var j=e.providerValue;j.visible=d;var x=(0,N.jsx)(m,T()(T()({},S),{},{title:e.getTitle(),data:t.data,value:R,required:i,disabled:t.disabled||l,visible:d,formInstance:e.formInstance,error:s,errors:u,onChange:e.onChange,ref:h}));return $?(0,N.jsx)(ke.Provider,{value:j,children:x}):x}}],[{key:"getDerivedStateFromProps",value:function(e,t){var r=null;function a(i){var s=e[i];!Z(s)&&s!==t["_".concat(i)]&&(r=r||{},r[i]=s,r["_".concat(i)]=s)}return["value"].forEach(a),r}}]),f}(k.Component);y()(me,"contextType",I.Context),y()(me,"defaultProps",{inline:Ue,unique:Se,deliver:dt,injectListName:Te,preserve:ft,unionValidate:ct});function Ae(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=o.defaultValue;return function(f){return function(n){return(0,N.jsx)(Y.Consumer,{children:function(t){var r=t,a=n.initialValue,i=n.form,s=n.inline,u=s===void 0?Ue:s,l=n.injectListName,d=l===void 0?Te:l;if(r&&d){var v=r.data[r.index];a=i?A(v)&&i in v?v[i]:u?a:v:Z(v)?a:v}return(0,N.jsx)(ke.Consumer,{children:function(m){return(0,N.jsx)(me,T()(T()({defaultValue:c},n),{},{parentField:m,initialValue:a,eachConfig:r,__Component__:f}))}})}})}}}var ae=function(c){var f=c.children,n=c.component,e=c.provider,t=(0,k.useContext)(Q);if(!t||!f)return null;var r=t.keys,a=t.form,i=t.listInstance,s=r.map(function(u,l){var d=T()(T()({},t),{},{form:D(a)?String(l):"".concat(a,".").concat(l),index:l,key:u,remove:i.removeItem.bind(i,l),add:i.addItem.bind(i),move:i.moveItem.bind(i)}),v=(0,N.jsx)(Y.Provider,{value:d,children:f(d)},u);return e?e(d,v):v});return n?n(t,s):(0,N.jsx)(N.Fragment,{children:s})},ge=function(o){se()(f,o);var c=oe()(f);function f(n,e){var t;ne()(this,f),t=c.call(this,n,e),y()(b()(t),"deleteIndex",[]),y()(b()(t),"uuid",0),y()(b()(t),"fieldType",J.List);var r=b()(t),a=n.formList;return r.genID=r.genID.bind(r),r.addItem=r.addItem.bind(r),r.removeItem=r.removeItem.bind(r),r.moveItem=r.moveItem.bind(r),r.state=r.initState(),a&&a.__REF__&&(a.__REF__.current=r),t}return ie()(f,[{key:"initState",value:function(){var e=this,t=e.props,r=e.context;e._initID();var a=t.initRows,i=t.initialValue,s=e.getFormName(t);r&&r.initialValue&&(D(s)?V(r.initialValue)&&(i=r.initialValue):i=K(r.initialValue,s,i));var u=Array(a),l=i;V(i)&&l.length&&(a=l.length,u=l);var d=Array(a).fill(1).map(e.genID);return{keys:d,data:u}}},{key:"_initID",value:function(){this.uuid=1e3}},{key:"genID",value:function(){return"CC".concat(++this.uuid)}},{key:"getFormName",value:function(e){var t=e.form,r=e.eachConfig;return r?t?"".concat(r.form,".").concat(t):r.form:t}},{key:"setData",value:function(e){var t=this,r=t.props.initRows,a=t.state.keys;O(e)||!V(e)?e=[]:e.length===0&&(e=Array(r)),t.removeOutData(e.length),a=a.slice(0,e.length),t.setState({keys:a,data:e})}},{key:"getData",value:function(){return this.state.data}},{key:"addItem",value:function(e,t){var r,a=this,i=a.genID(),s=a.state,u=s.data,l=s.keys;l=Array.from(l),!O(t)&&t<u.length?(l.splice(t,0,i),u.splice(t,0,e),a.removeListData(t,1)):(l.push(i),u.push(e)),a.setState({keys:l,data:u}),(r=a.context)===null||r===void 0||r.formInstance.formChange()}},{key:"removeItem",value:function(e){var t=this,r=t.state,a=r.data,i=r.keys,s=i.length,u=(V(e)?e:[e]).filter(function(d){return d<s});if(u.length){var l;(l=t.deleteIndex).push.apply(l,Oe()(u)),t.removeListData(s-u.length,u.length),i=Array.from(i),u.forEach(function(d,v){i.splice(d-v,1),a.splice(d-v,1)}),t.setState({keys:i,data:a})}}},{key:"moveItem",value:function(e,t){var r=this,a=r.state,i=a.data,s=a.keys;if(e!==t&&e>=0&&e<s.length&&t>=0&&t<s.length){var u;s=Array.from(s);var l=s[e],d=i[e];s.splice(e,1),s.splice(t,0,l),i.splice(e,1),i.splice(t,0,d),r.setState({keys:s,data:i}),(u=r.context)===null||u===void 0||u.formInstance.formChange()}}},{key:"removeListData",value:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=this,a=r.getFormName(r.props),i=r.context,s=i.data,u=i.formInstance,l=e+t,d=[],v=e;v<l;v++)d.push(a?"".concat(a,".").concat(v):String(v));var h=function(F){d.forEach(function(g){F.indexOf(g)===0&&u.deleteField(F)})};for(var m in s)h(m)}},{key:"removeOutData",value:function(e){var t=this,r=t.getFormName(t.props),a=t.context,i=a.data,s=a.formInstance,u=r?Array(e).fill(1).map(function(l,d){return"".concat(r,".").concat(d)}):[];Object.keys(i).forEach(function(l){if(D(r)){var d=Number(l),v=l.substr(0,l.indexOf("."));String(d)===l&&d<e?s.deleteField(l,{isChange:!1}):/^[0-9]+$/.test(v)&&Number(v)>=e&&s.deleteField(l,{isChange:!1})}else l.indexOf(String(r))===0&&u.findIndex(function(h){return l.indexOf(h)!==-1})===-1&&s.deleteField(l,{isChange:!1})})}},{key:"getConfig",value:function(){return{form:this.getFormName(this.props)}}},{key:"componentDidMount",value:function(){var e;(e=this.context)===null||e===void 0||e.formInstance.setField(this)}},{key:"componentWillUnmount",value:function(){var e;(e=this.context)===null||e===void 0||e.formInstance.unmountField(this)}},{key:"shouldComponentUpdate",value:function(e,t){var r=this,a=r.props,i=r.state;return e.form!==a.form||t.keys!==i.keys||r.getFormName(e)!==r.getFormName(a)||$e(a.shouldUpdate,e.shouldUpdate)}},{key:"componentDidUpdate",value:function(e,t,r){if(t.keys!==this.state.keys){var a;(a=this.context)===null||a===void 0||a.formInstance.observeField()}}},{key:"render",value:function(){var e=this,t=e.context,r=e.getFormName(e.props),a=e.props.children,i=e.state,s=i.keys,u=i.data;if(!a||!V(s))return null;var l={form:r,listInstance:e,keys:s,data:u,length:s.length,formData:t.data},d=B(a)?(0,N.jsx)(ae,{children:a}):a;return(0,N.jsx)(Q.Provider,{value:l,children:d})}}]),f}(k.Component);y()(ge,"contextType",I.Context),y()(ge,"defaultProps",{initRows:1});var pe=function(c){var f=(0,k.useContext)(Y),n=c.form,e=c.initialValue,t=c.children,r=f;if(r){var a=r.data[r.index];e=n?A(a)&&n in a?a[n]:e:a}return(0,N.jsx)(ge,T()(T()({},c),{},{initialValue:e,eachConfig:r,children:t}))};pe.View=ae;var Ne=function(c){var f=c.children,n=(0,k.useContext)(Q);if(!n)return null;var e=n.listInstance,t=T()(T()({},n),{},{remove:e.removeItem,add:e.addItem,move:e.moveItem});return(0,N.jsx)(N.Fragment,{children:f(t)})},ht=["children","forProps"];function ye(){return function(o){return(0,k.forwardRef)(function(c,f){return(0,N.jsx)(Y.Consumer,{children:function(e){return(0,N.jsx)(I.Context.Consumer,{children:function(r){return(0,N.jsx)(o,T()(T()(T()({},c),{},{ref:f},r),{},{eachConfig:e||void 0}))}})}})})}}var Re=ye()(function(o){var c=o.children,f=o.forProps,n=Ee()(o,ht);return(0,k.cloneElement)(c,f?f(n):n)});I.List=pe,I.ListView=ae,I.Field=Ae,I.Outlet=ye,I.OutletView=Re,I.ListAction=Ne}}]);
