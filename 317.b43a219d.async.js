"use strict";(self.webpackChunkexample=self.webpackChunkexample||[]).push([[317],{8317:function(ht,De,y){y.r(De),y.d(De,{CCField:function(){return Ue},CCForm:function(){return L},CCList:function(){return me},CCListAction:function(){return xe},CCListView:function(){return te},CCOutlet:function(){return ge},CCOutletView:function(){return Ne}});var Re=y(3769),Ve=y.n(Re),Ae=y(5009),j=y.n(Ae),we=y(4599),w=y.n(we),je=y(9289),G=y.n(je),Me=y(7857),T=y.n(Me),qe=y(5574),Pe=y.n(qe),We=y(2444),re=y.n(We),Ge=y(2004),ae=y.n(Ge),Be=y(5098),F=y.n(Be),He=y(1996),ne=y.n(He),ze=y(6037),ie=y.n(ze),Ze=y(9783),g=y.n(Ze),I=y(7294),Ke={visible:!0},se=(0,I.createContext)(null),X=(0,I.createContext)(null),J=(0,I.createContext)(null),ke=(0,I.createContext)(Ke),Xe=y(9632),Oe=y.n(Xe),Q=function(c){return{subData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.subData(n)},validate:function(){var n;return(n=c.current)===null||n===void 0?void 0:n.validate()},asyncValidate:function(){var f=G()(j()().mark(function e(){var t;return j()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(t=c.current)===null||t===void 0?void 0:t.asyncValidate();case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},e)}));function n(){return f.apply(this,arguments)}return n}(),validateErrors:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.validateErrors(n)},asyncValidateErrors:function(){var f=G()(j()().mark(function e(t){var r;return j()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",(r=c.current)===null||r===void 0?void 0:r.asyncValidateErrors(t));case 1:case"end":return i.stop()}},e)}));function n(e){return f.apply(this,arguments)}return n}(),setOriginData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.setOriginData(n)},setFieldData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.setFieldData(n)},addData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.addData(n)},setData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.setData(n)},__REF__:c}},oe=function(c){return{add:function(n,e){var t;return(t=c.current)===null||t===void 0?void 0:t.addItem(n,e)},remove:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.removeItem(n)},move:function(n,e){var t;return(t=c.current)===null||t===void 0?void 0:t.moveItem(n,e)},setData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.setData(n)},getData:function(){var n;return(n=c.current)===null||n===void 0?void 0:n.getData()},getSize:function(){var n;return((n=c.current)===null||n===void 0?void 0:n.getData().length)||0},__REF__:c}},Je=function(){return Q((0,I.createRef)())},Qe=function(){var c=(0,I.useRef)(null);return[(0,I.useMemo)(function(){return Q(c)},[])]},Ye=function(){var c=(0,I.useContext)(se),f=c.formInstance,n=(0,I.useRef)(f);return n.current=f,(0,I.useMemo)(function(){return Q(n)},[])},_e=function(){return oe((0,I.createRef)())},et=function(){var c=(0,I.useRef)(null);return[(0,I.useMemo)(function(){return oe(c)},[])]},tt=function(){var c=(0,I.useContext)(X),f=c.listInstance,n=(0,I.useRef)(f);return n.current=f,(0,I.useMemo)(function(){return oe(n)},[])},M=y(865);function Y(o){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,f=null,n=null,e=function(r){n=r,f&&clearTimeout(f),f=setTimeout(function(){f=null,n&&n()},c)};return(0,M.N7)(o,{scheduler:e})}var rt=y(2677),ue=y.n(rt),Z=Object.prototype.toString;function P(o){return typeof o=="function"}function mt(o){return typeof o=="number"||Z.call(o)==="[object Number]"}function _(o){return typeof o=="string"||Z.call(o)==="[object String]"}function at(o){return typeof o=="boolean"||Z.call(o)==="[object Boolean]"}function S(o){return ue()(o)==="object"&&Z.call(o)==="[object Object]"}function Ie(o){return ue()(o)==="object"&&(Z.call(o)==="[object Promise]"||Promise.resolve(o)===o)}function b(o){return Array.isArray(o)}function B(o){return typeof o=="undefined"}function nt(o){return o===null}function $(o){return B(o)||nt(o)}function V(o){return $(o)||!String(o).trim().length}function le(o){return $(o)||!S(o)||!Object.getOwnPropertyNames(o).length}function ee(o){return $(o)||!b(o)||!o.length}function ve(o,c){var f=0;return o.indexOf("[")!==-1?o.replace(/(\w)\[+([\w.\s]*)]+/g,function(n,e,t){var r="[".concat(t.replace(/\./g,"_"),"_").concat(++f,"]");return t.indexOf(".")!==-1?(c[r]=t,"".concat(e,".").concat(r)):"".concat(e,".").concat(t)}):o}function de(o,c,f){if($(o)||V(c))return f;if(S(o)||b(o)){var n=o,e={};if(c in o)n=o[c];else{var t=ve(c,e).split("."),r=w()(t),a;try{for(r.s();!(a=r.n()).done;){var i=a.value;if(n=i in e?n[e[i]]:n[i],!n)break}}catch(s){r.e(s)}finally{r.f()}}return $(n)?f:n}else return o}function H(o,c,f){if($(o)||V(c))return f;if(S(o)||b(o)){var n=o,e={};if(c in o)n=o[c];else for(var t=ve(String(c),e).split("."),r=0,a=t.length;r<a;r++){var i=t[r];if(S(n)||b(n)){var s=t.slice(r).join(".");if(s in n){n=s in e?n[e[s]]:n[s];break}}if(n=i in e?n[e[i]]:n[i],!n)break}return B(n)?f:n}else return o}function it(o,c){var f=Object.create(null);(c||[]).forEach(function(e){var t=e.form,r=e.transform,a=e.inline,i=a===void 0?!0:a,s=st(o[t]);if(P(r)?s=b(s)?s.map(function(h,m){return r(h,o,m)}):r(s,o):V(r)||(s=b(s)?s.map(function(h){return de(h,r)}):de(s,r)),t=t.replace(/@\w*/g,""),i)fe(f,t,s);else{var l=t.lastIndexOf(".");if(l!==-1){var u=t.substr(0,l),d=t.substr(l+1),v=de(f,u);s=S(s)?s:g()({},d,s),b(v)?s=v.push(s):S(v)&&(s=Object.assign(v,s)),fe(f,u,s)}else S(s)?Object.assign(f,s):f[t]=s}});var n=Object.keys(f);return n.every(function(e){return/^([1-9]\d*|0)$/.test(e)})&&(f.length=n.length,f=Array.from(f).filter(function(e){return!$(e)})),f}function fe(o,c,f){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},e=n.ks,t=e===void 0?{}:e,r=ve(c,t),a=r.indexOf(".");if(~a){var i=r.split("."),s=i[0],l=i.slice(1).join("."),u=o[s]||(l[0]==="0"?[]:Object.create(null)),d=fe(u,l,f,T()({ks:t},n));u!==o[s]&&(o[s in t?t[s]:s]=d)}else(!b(o)||!$(f))&&(o[c in t?t[c]:c]=f);return o}function st(o){return(0,M.bi)(o)?b(o)?Array.from(o):Object.assign({},o):o}function ot(o,c){return c&&c.target&&ue()(c.target)==="object"&&o in c.target?c.target[o]:c}var U=y(5893),K;(function(o){o[o.Field=1]="Field",o[o.List=2]="List"})(K||(K={}));var q;(function(o){o[o.DEFAULT=0]="DEFAULT",o[o.SET=1]="SET"})(q||(q={}));function Ee(o){return o.fieldType===K.Field}var L=function(o){ne()(f,o);var c=ie()(f);function f(n){var e;re()(this,f),e=c.call(this,n),g()(F()(e),"originData",void 0),g()(F()(e),"fieldStatus",M.LO({})),g()(F()(e),"changeState",q.DEFAULT),g()(F()(e),"fields",new Set),g()(F()(e),"fieldsMap",new Map),g()(F()(e),"removeFields",new Set),g()(F()(e),"updateFields",new Set),g()(F()(e),"listFields",new Set),g()(F()(e),"providerValue",{}),g()(F()(e),"timeoutChange",void 0),g()(F()(e),"tempFields",void 0),g()(F()(e),"autoRunTime",void 0);var t=F()(e),r=n.emitter,a=n.form;return t.state={data:M.LO({}),originData:{}},t.providerValue={formInstance:t,emitter:r},a&&a.__REF__&&(a.__REF__.current=t),e}return ae()(f,[{key:"componentWillUnmount",value:function(){this.unObserveField()}},{key:"shouldComponentUpdate",value:function(e,t){var r=this;return t.data!==r.state.data||e.children!==r.props.children||e.disabled!==r.props.disabled}},{key:"getSnapshotBeforeUpdate",value:function(e,t){var r=this;return t.data!==r.state.data&&(r.unObserveField(),r.revertField(),r.revertListField()),null}},{key:"componentDidUpdate",value:function(e,t){var r=this;r.changeState=q.DEFAULT,t.data!==r.state.data&&r.observeField()}},{key:"revertListField",value:function(){var e=w()(this.listFields),t;try{for(e.s();!(t=e.n()).done;){var r=t.value,a=r.initState();r.removeOutData(a.data.length),r.setState(a)}}catch(i){e.e(i)}finally{e.f()}}},{key:"revertField",value:function(){var e=this,t=w()(e.fields),r;try{for(t.s();!(r=t.n()).done;){var a=r.value,i=a.initState(),s=a.getFormName();!V(s)&&!(s in e.state.data)&&e._setFieldValue(s,i.value,{raw:!0}),a.setState(i)}}catch(l){t.e(l)}finally{t.f()}}},{key:"unObserveField",value:function(){var e=w()(this.fields),t;try{for(e.s();!(t=e.n()).done;){var r=t.value;r.unObserveData()}}catch(a){e.e(a)}finally{e.f()}}},{key:"observeField",value:function(){var e=w()(this.fields),t;try{for(e.s();!(t=e.n()).done;){var r=t.value;r.observeData()}}catch(a){e.e(a)}finally{e.f()}}},{key:"fieldAutoRun",value:function(){var e=w()(this.updateFields),t;try{for(e.s();!(t=e.n()).done;){var r=t.value;r.observeData()}}catch(a){e.e(a)}finally{e.f()}this.updateFields.clear()}},{key:"handleChange",value:function(e){var t,r,a=this;(t=(r=a.props).onChange)===null||t===void 0||t.call(r,a.state.originData,e),a.changeState=q.DEFAULT}},{key:"fieldChange",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=this,i=r.raw,s=i===void 0?!1:i;V(e)||a.state.data[e]===t||(a._setFieldValue(e,t,{raw:s}),a.formChange(e))}},{key:"deleteField",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this,a=t.isChange,i=a===void 0?!0:a;$(e)||(delete M.LZ(r.state.data)[e],delete r.state.originData[e],i&&r.formChange(e))}},{key:"formChange",value:function(e){var t,r=this;clearTimeout(r.timeoutChange);var a=!V(e)&&((t=r.getField(e))===null||t===void 0?void 0:t.props);r.tempFields=r.tempFields||[],a&&r.tempFields.push(a),r.timeoutChange=setTimeout(function(){r.handleChange(r.tempFields),r.tempFields=[]})}},{key:"_setFieldValue",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=r.raw,i=a===void 0?!1:a;if(!V(e)){var s=this.state.data;(i?M.LZ(s):s)[e]=t,this.state.originData[e]=t}}},{key:"setFieldStatus",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=r.raw,i=a===void 0?!1:a;if(!V(e)){var s=t.disabled,l=t.required,u=t.error,d=t.visible;(i?M.LZ(this.fieldStatus):this.fieldStatus)[e]={disabled:s,visible:d,required:l,validate:$(u)?void 0:!u}}}},{key:"setField",value:function(e){var t=this;if(Ee(e)){var r=e.getFormName();V(r)||t.fieldsMap.set(r,e),t.fields.add(e),t._setFieldValue(r,e.value,{raw:!0}),t.setFieldStatus(r,e.getConfig(),{raw:!0}),t.updateFields.add(e),clearTimeout(t.autoRunTime),t.autoRunTime=setTimeout(function(){return t.fieldAutoRun()})}else t.listFields.add(e)}},{key:"renameField",value:function(e,t){this.fieldsMap.set(e,t)}},{key:"getField",value:function(e){return V(e)?null:this.fieldsMap.get(e)}},{key:"unmountField",value:function(e){var t=this;if(Ee(e)){var r=e.getFormName();e.unObserveData(),t.fields.delete(e),t.removeFields.add(e),!V(r)&&t.fieldsMap.delete(r)}else t.listFields.delete(e)}},{key:"setOriginData",value:function(e){var t=this;t.originData=e;var r=w()(t.listFields),a;try{for(r.s();!(a=r.n()).done;){var i=a.value,s=i.getConfig(),l=s.form;if(V(l))b(e)&&i.setData(e);else{var u=H(e,String(l));u&&i.setData(u)}}}catch(d){r.e(d)}finally{r.f()}t.setData(e,{isGet:!0,isChange:!1})}},{key:"setFieldData",value:function(e){this.setData(e,{isGet:!0,isChange:!0})}},{key:"setData",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this;if(!$(e)){var a=t.isGet,i=a===void 0?!1:a,s=t.isChange,l=s===void 0?!1:s;r.changeState=q.SET;var u=0,d=function(){setTimeout(function(){u--,u<=0&&(r.changeState=q.DEFAULT)})},v=w()(r.fields),h;try{for(v.s();!(h=v.n()).done;){var m=h.value,p=m.getConfig(),C=p.form,E=p.convertValue,R=p.alias;if(C){for(var D=Symbol(),k=D,x=0,N=[C].concat(Oe()(R));x<N.length;x++){var A=N[x],O=H(e,A,D);O!==D&&(k=O,C=A)}if(D===k)continue;k=i&&P(E)?m.execGetValue(C,k,e):k,u++,l?m.handleChange(k,d):m.setValue(k,d)}}}catch(W){v.e(W)}finally{v.f()}u===0&&(r.changeState=q.DEFAULT)}}},{key:"addData",value:function(e){for(var t in e)e.hasOwnProperty(t)&&this._setFieldValue(t,e[t])}},{key:"validate",value:function(){return this.validateErrors().length===0}},{key:"asyncValidate",value:function(){var n=G()(j()().mark(function t(){return j()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.asyncValidateErrors();case 2:return a.t0=a.sent.length,a.abrupt("return",a.t0===0);case 4:case"end":return a.stop()}},t,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"validateErrors",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=new Map;return this._validateErrors(t,function(r,a){return a(r.validateErrors())},e),Array.from(t.values())}},{key:"asyncValidateErrors",value:function(){var n=G()(j()().mark(function t(){var r=this,a,i=arguments;return j()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return a=i.length>0&&i[0]!==void 0?i[0]:[],l.abrupt("return",new Promise(function(u){var d=new Map,v=0,h=0,m=r._validateErrors(d,function(p,C){v++,G()(j()().mark(function E(){return j()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.t0=C,D.next=3,p.asyncValidateErrors();case 3:D.t1=D.sent,(0,D.t0)(D.t1),h++,h===v&&u(Array.from(d.values()));case 7:case"end":return D.stop()}},E)}))()},a);!m&&u([])}));case 2:case"end":return l.stop()}},t)}));function e(){return n.apply(this,arguments)}return e}()},{key:"_validateErrors",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=!1,i=w()(this.fields),s;try{var l=function(){var d=s.value,v=d.getConfig();v.form&&v.visible&&v.parentVisible&&(!r.length||r.findIndex(function(h){return String(v.form).indexOf(String(h))===0})!==-1)&&(a=!0,t(d,function(h){var m=h.error,p=h.errors;m&&e.set(v.form,{key:v.form,ref:d,messages:p})}))};for(i.s();!(s=i.n()).done;)l()}catch(u){i.e(u)}finally{i.f()}return a}},{key:"subData",value:function(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=this,a=t.merge,i=a===void 0?!1:a,s=[],l=[],u=r.state,d=u.data,v=u.initialValue,h=w()(r.removeFields),m;try{for(h.s();!(m=h.n()).done;){var p=m.value,C=p.getConfig();C.form&&l.push(C.form)}}catch(z){h.e(z)}finally{h.f()}var E=w()(r.fields),R;try{for(E.s();!(R=E.n()).done;){var D=R.value,k=D.getConfig();k.form&&(l.push(k.form),!k.ignore&&k.parentVisible&&k.visible&&s.push(k))}}catch(z){E.e(z)}finally{E.f()}var x=it(d,s);for(var N in d)!~l.indexOf(N)&&!(N in x)&&(x[N]=d[N]);var A=(e=r.originData)!==null&&e!==void 0?e:v;if(i&&A){var O=w()(r.listFields),W;try{var pe=function(){var ye=W.value,dt=ye.getConfig(),Te=dt.form,Ce=ye.getData(),ft=ye.deleteIndex,be=H(x,String(Te));Te&&be&&Ce&&S(Ce[0])&&Ce.forEach(function(ct,Fe){ft.includes(Fe)||(be[Fe]=Object.assign({},ct,be[Fe]))})};for(O.s();!(W=O.n()).done;)pe()}catch(z){O.e(z)}finally{O.f()}return Object.assign({},A,x)}return x}},{key:"data",get:function(){return this.state.data}},{key:"render",value:function(){var e=this,t=e.props.disabled,r=t===void 0?!1:t,a=e.state,i=a.data,s=a.originData,l=a.initialValue,u=e.providerValue;return u.data=i,u.originData=s,u.initialValue=l,u.disabled=r,u.fieldStatus=e.fieldStatus,(0,U.jsx)(se.Provider,{value:u,children:e.props.children})}}],[{key:"getDerivedStateFromProps",value:function(e,t){var r=e.data,a=e.initialValue;return r&&r!==t.originData?{data:M.LO(r),originData:r}:a&&a!==t.initialValue?{data:M.LO({}),originData:{},initialValue:a}:null}}]),f}(I.Component);g()(L,"Context",se),g()(L,"useForm",Qe),g()(L,"useFormInstance",Ye),g()(L,"useList",et),g()(L,"useListInstance",tt),g()(L,"createForm",Je),g()(L,"createList",_e),g()(L,"Outlet",void 0),g()(L,"OutletView",void 0),g()(L,"List",void 0),g()(L,"Field",void 0),g()(L,"ListView",void 0),g()(L,"ListAction",void 0);var ut=["forwardRef","__Component__","preserve","title","valuePropName","forValue","parentField","deliver"],$e="id",Le=!0,lt=!0,Se=!0,ce=function(o){ne()(f,o);var c=ie()(f);function f(n,e){var t,r;re()(this,f),r=c.call(this,n,e),g()(F()(r),"formInstance",void 0),g()(F()(r),"changeFlag",!1),g()(F()(r),"changeForm",!1),g()(F()(r),"isObserveUnion",!1),g()(F()(r),"unmount",!1),g()(F()(r),"observeReactions",[]),g()(F()(r),"providerValue",{}),g()(F()(r),"fieldType",K.Field);var a=F()(r);return a.listenerValueChange=a.listenerValueChange.bind(a),a.onChange=a.onChange.bind(a),a.observeVisible=a.observeVisible.bind(a),a.observeDisabled=a.observeDisabled.bind(a),a.observeRequired=a.observeRequired.bind(a),a.formInstance=Q({current:(t=e==null?void 0:e.formInstance)!==null&&t!==void 0?t:null}),a.state=a.initState(),a.providerValue={fieldInstance:a},r}return ae()(f,[{key:"initState",value:function(){var e=this,t=e.props,r=e.context,a=t.initialValue,i=t.convertValue,s=t.defaultValue,l=t.visible,u=t.disabled,d=e.getFormName(t),v={},h=B(a)?s:a;!V(d)&&r&&(r.initialValue&&(v=r.initialValue,h=H(r.initialValue,d,h)),r.data&&d in r.data&&!B(r.data[d])&&(h=r.data[d]));var m=e.getOptions(),p=m.options,C=m.data,E=e.findRequired(C,p),R=E.required,D=E.message,k={value:P(i)?e.execGetValue(d,h,v):h,initialValue:h,visible:$(l)?!0:!!e.execCallback(l,C,p),disabled:$(u)?!1:!!e.execCallback(u,C,p),required:R,requiredMsg:D,_refreshMark:{}};return e.changeFlag=!1,e.changeForm=!1,e.isObserveUnion=!1,k}},{key:"getFormName",value:function(e){var t=e||this.props,r=t.form,a=t.eachConfig,i=t.injectListName;return a&&i?typeof r!="number"&&r?"".concat(a.form,".").concat(r):a.form:r}},{key:"getFormAlias",value:function(e){var t=e||this.props,r=t.alias,a=t.eachConfig;return V(r)?[]:(r=b(r)?r:[r],r.map(function(i){return a?i?"".concat(a.form,".").concat(i):a.form:i}))}},{key:"findRequired",value:function(e,t){var r=this,a=r.props.rules;if(!$(a)){a=S(a)?[a]:a;var i=function(u){return S(u)&&!!r.execCallback(u.required,e,t)};if(b(a)){var s=a.find(i);return{required:!!(s!=null&&s.required),message:s==null?void 0:s.message}}else return{required:r.execCallback(a,e,t)===!0}}return{required:!1}}},{key:"execGetValue",value:function(e,t,r){var a=this.props,i=a.convertValue,s=a.eachConfig,l=a.inline;if(!l&&!V(e)){var u=String(e),d=s&&s.form?s.form:u.substring(0,u.lastIndexOf(".")),v=V(d)?r:H(r,d);t=v!=null?v:t}try{return i(t)}catch(h){console.warn("ConvertValue:",h)}}},{key:"observeData",value:function(){var e=this;e.unObserveData(),e.observeReactions.push(Y(e.observeVisible),Y(e.observeDisabled),Y(e.observeRequired)),e.observeUnion()}},{key:"unObserveData",value:function(){this.observeReactions.forEach(function(e){return M.p_(e)}),this.observeReactions=[]}},{key:"getOptions",value:function(){var e=this,t=e.props.eachConfig||{},r=t.form,a=t.data,i=e.state||{},s=i.value,l=i.disabled,u=i.visible,d=i.error,v=i.required,h=e.context,m=h.data,p=h.originData,C=h.fieldStatus,E={form:r,val:s,data:p,status:C,selfStatus:{disabled:l,visible:u,required:v,validate:$(d)?void 0:!d},listData:a};return{options:E,data:m,originData:p}}},{key:"observeDisabled",value:function(){var e=this;if(!e.unmount){var t=e.props.disabled,r=e.getOptions(),a=r.options,i=r.data;$(t)||(e.disabled=!!e.execCallback(t,i,a))}}},{key:"observeVisible",value:function(){var e=this;if(!e.unmount){var t=e.props.visible,r=e.getOptions(),a=r.options,i=r.data;$(t)||(e.visible=!!e.execCallback(t,i,a))}}},{key:"observeRequired",value:function(){var e=this;if(!e.unmount){var t=e.getOptions(),r=t.options,a=t.data,i=e.findRequired(a,r),s=i.required,l=i.message;e.required=s,e.requiredMsg=l}}},{key:"observeUnion",value:function(){var e=this;e.isObserveUnion=!1;var t=e.context,r=e.getUnionList();if(!(e.unmount||ee(r))){var a=e.props.unionValue,i=t.formInstance,s=e.getFormName();a=P(a)?a:function(){};var l=function u(d){var v,h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],m=((v=i.getField(d))===null||v===void 0?void 0:v.getUnionList())||[];return m.forEach(function(p){var C=b(p)?p[0]:p;h.indexOf(C)===-1&&(h.push(C),u(C,h))}),h};r.forEach(function(u){var d=b(u)?u:[u,a],v=Pe()(d,2),h=v[0],m=v[1],p=l(h,[h]),C=Y(function(){var E=e.getOptions(),R=E.options,D=E.data,k=E.originData,x=e.execCallback(m,D[h],T()(T()({},R),{},{data:k})),N=function(){return!e.unmount&&h in D&&e.handleChange(x)};$(s)&&N(),e.isObserveUnion&&(i==null?void 0:i.changeState)!==q.SET?N():p.forEach(function(A){return D[A]})});e.observeReactions.push(C)}),e.isObserveUnion=!0}}},{key:"getUnionList",value:function(){var e=this,t=e.props.union;if(V(t))return null;var r=e.getOptions(),a=r.options;return t=P(t)?t(a):t,V(t)?null:(t=b(t)?t:t.split(","),t)}},{key:"execCallback",value:function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return P(e)?e.apply(void 0,r):e}catch(i){console.warn(i)}}},{key:"getTitle",value:function(){var e=this,t=e.getOptions(),r=t.options,a=t.data;return e.execCallback(e.props.title,a,r)}},{key:"getConfig",value:function(e,t){var r=this;e=e||r.props,t=t||r.state;var a=e,i=a.inline,s=a.transform,l=a.ignore,u=a.convertValue,d=a.parentField,v=t,h=v.disabled,m=v.visible,p=v.error,C=v.required;return{inline:i,form:r.getFormName(e),alias:r.getFormAlias(e),transform:s,visible:m,parentVisible:d.visible,disabled:h,ignore:l,error:p,required:C,convertValue:u}}},{key:"onChange",value:function(e){var t=this,r=t.props,a=r.normalize,i=r.valuePropName,s=i===void 0?"value":i,l=t.context;e=ot(s,e);for(var u=arguments.length,d=new Array(u>1?u-1:0),v=1;v<u;v++)d[v-1]=arguments[v];t.handleChange(a?a(e,{val:t.state.value,data:l.data,args:d}):e)}},{key:"handleChange",value:function(e,t){var r,a=this;if(!(a.unmount||e===a.state.value)){var i=a.context,s=a.props.listener,l=s===void 0?{}:s,u=l.key,d=l.transform;a.changeFlag=!0,a.changeForm=!0,u&&((r=i.emitter)===null||r===void 0||r.emit(u,d?d(e,i.data):e)),a.handleValue(e,t)}}},{key:"setValue",value:function(e,t){this.changeForm=!0,this.handleValue(e,t)}},{key:"value",get:function(){return this.state.value}},{key:"handleValue",value:function(e,t){var r=this,a=r.state.value;!r.unmount&&!r.equalsValue(e,a)?r.setState({value:e},t):t&&t()}},{key:"equalsValue",value:function(e,t){var r=this,a=r.props,i=a.label,s=a.unique,l=s===void 0?$e:s;if(e===t)return!0;var u=function(v,h){if(le(v)||le(h))return!1;var m,p;return l in v||l in h?(m=v[l],p=h[l]):i&&(i in v||i in h)&&(m=v[i],p=h[i]),r.equalsValue(m,p)};return S(e)||S(t)?u(e,t):b(e)||b(t)?ee(e)||ee(t)||e.length!==t.length?!1:e.every(function(d,v){return r.equalsValue(d,t[v])}):String(e)===String(t)}},{key:"disabled",set:function(e){e!==this.state.disabled&&this.setState({disabled:e})}},{key:"required",set:function(e){e!==this.state.required&&this.setState({required:e})}},{key:"requiredMsg",set:function(e){e!==this.state.requiredMsg&&this.setState({requiredMsg:e})}},{key:"visible",set:function(e){var t=this;e!==t.state.visible&&(e||t.setState({error:void 0,errors:void 0}),t.setState({visible:e}))}},{key:"validateErrors",value:function(){return this._validateErrors(this.validate())}},{key:"asyncValidateErrors",value:function(){var n=G()(j()().mark(function t(){var r,a,i,s,l,u,d,v;return j()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(r=this,a=r.validate({async:!0}),!b(a)){m.next=36;break}i=[],s=!0,l=w()(a),m.prev=6,l.s();case 8:if((u=l.n()).done){m.next=27;break}if(d=u.value,!Ie(d)){m.next=24;break}return v=void 0,m.prev=12,m.next=15,d;case 15:v=m.sent,m.next=21;break;case 18:m.prev=18,m.t0=m.catch(12),v=m.t0;case 21:_(v)?i.push(v):v||(s=!1),m.next=25;break;case 24:i.push(d);case 25:m.next=8;break;case 27:m.next=32;break;case 29:m.prev=29,m.t1=m.catch(6),l.e(m.t1);case 32:return m.prev=32,l.f(),m.finish(32);case 35:a=i.length?i:s;case 36:return m.abrupt("return",this._validateErrors(a));case 37:case"end":return m.stop()}},t,this,[[6,29,32,35],[12,18]])}));function e(){return n.apply(this,arguments)}return e}()},{key:"_validateErrors",value:function(e){var t=this,r=t.state,a=r.errors,i=r.error,s,l;return at(e)?(l=!e,s=void 0):(l=!!e.length,s=e),l!==i&&t.setState({error:l}),t.equalsValue(a,s)||t.setState({errors:s,_refreshMark:{}}),{error:l,errors:s}}},{key:"validate",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=this,r=e.async,a=r===void 0?!1:r,i=t.props,s=i.ignore,l=i.rules,u=t.state,d=u.required,v=u.requiredMsg,h=u.value,m=u.visible;if(s&&!d||!m)return!0;var p=t.validateEmpty(h);if(d&&p)return V(v)?!1:[v];if(p)return!0;var C=t.getOptions(),E=C.options,R=C.originData,D=function(O){if(O&&O instanceof RegExp)return O.test(h);if(P(O))return O(R,E);if(S(O)){var W=O.pattern,pe=O.message;if(W&&!W.test(h))return pe||!1}return!0};if(b(l)){var k=[],x=!0;return l.forEach(function(A){var O=D(A);_(O)||a&&Ie(O)?k.push(O):O||(x=!1)}),k.length?k:x}else if(S(l)){var N=D(l);return _(N)?[N]:N}return!0}},{key:"validateEmpty",value:function(e){var t=this.props.label,r=function(i){return le(i)||!!(t&&V(i[t]))};return $(e)?!0:_(e)?V(e):S(e)?r(e):b(e)?ee(e)||S(e[0])&&r(e[0]):$(e)}},{key:"listenerValueChange",value:function(e){var t=this,r=this.context,a=t.props.listener;t.handleValue(a!=null&&a.convertValue?a.convertValue(e,r.data):e)}},{key:"componentDidMount",value:function(){var e,t=this,r=t.context,a=t.props.listener,i=a===void 0?{}:a,s=i.key;s&&((e=r.emitter)===null||e===void 0||e.addListener(s,t.listenerValueChange)),r.formInstance.setField(t)}},{key:"componentWillUnmount",value:function(){var e,t=this;t.unmount=!0;var r=t.context,a=t.props.listener,i=a===void 0?{}:a,s=i.key;s&&((e=r.emitter)===null||e===void 0||e.removeListener(s,t.listenerValueChange)),r.formInstance.unmountField(t)}},{key:"shouldComponentUpdate",value:function(e,t){var r=this,a=r.props,i=r.state,s=function(){var u=e.shouldUpdate,d=a.shouldUpdate;return b(u)&&b(d)?u.some(function(v,h){return v!==d[h]}):u!==d};return t.value!==i.value||t.required!==i.required||t.error!==i.error||t.visible!==i.visible||t.disabled!==i.disabled||t._refreshMark!==i._refreshMark||e.form!==a.form||r.getFormName(e)!==r.getFormName(a)||s()}},{key:"getSnapshotBeforeUpdate",value:function(e,t){var r=this,a=this.context,i=a.formInstance,s=r.state,l=s.required,u=s.error,d=s.visible,v=s.disabled,h=r.getFormName(r.props),m=r.getFormName(e);return e.form!==this.props.form&&i.unmountField(this),h!==m&&!V(h)&&i.renameField(h,r),(l!==t.required||u!==t.error||d!==t.visible||v!==t.disabled)&&i.setFieldStatus(h,{required:l,error:u,visible:d,disabled:v}),null}},{key:"componentDidUpdate",value:function(e,t){var r=this,a=this.context,i=a.formInstance,s=r.state,l=s.value,u=s.required,d=s.error,v=r.getFormName(r.props);if(l!==t.value){var h,m;i.fieldChange(v,l,{raw:!r.changeForm}),r.changeFlag&&((h=(m=r.props).onChange)===null||h===void 0||h.call(m,l))}(l!==t.value&&r.changeFlag||u!==t.required&&!u&&!$(d))&&r.asyncValidateErrors(),e.form!==r.props.form&&i.setField(r),v!==r.getFormName(e)&&i.fieldChange(v,l,{raw:!0}),r.changeFlag=!1,r.changeForm=!1}},{key:"render",value:function(){var e=this,t=e.context,r=e.state,a=r.value,i=r.required,s=r.error,l=r.errors,u=r.disabled,d=r.visible,v=e.props,h=v.forwardRef,m=v.__Component__,p=v.preserve,C=v.title,E=v.valuePropName,R=v.forValue,D=v.parentField,k=v.deliver,x=Ve()(v,ut);if(!d&&!p)return null;var N=R?R(a,t.data):a;E&&(x[E]=N);var A=e.providerValue;A.visible=d;var O=(0,U.jsx)(m,T()(T()({},x),{},{title:e.getTitle(),data:t.data,value:N,required:i,disabled:t.disabled||u,visible:d,formInstance:e.formInstance,error:s,errors:l,onChange:e.onChange,ref:h}));return k?(0,U.jsx)(ke.Provider,{value:A,children:O}):O}}],[{key:"getDerivedStateFromProps",value:function(e,t){var r=null;function a(i){var s=e[i];!B(s)&&s!==t["_".concat(i)]&&(r=r||{},r[i]=s,r["_".concat(i)]=s)}return["value"].forEach(a),r}}]),f}(I.Component);g()(ce,"contextType",L.Context),g()(ce,"defaultProps",{inline:Le,unique:$e,deliver:lt,injectListName:Se,preserve:!1});function Ue(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=o.defaultValue;return function(f){return function(n){return(0,U.jsx)(J.Consumer,{children:function(t){var r=t,a=n.initialValue,i=n.form,s=n.inline,l=s===void 0?Le:s,u=n.injectListName,d=u===void 0?Se:u;if(r&&d){var v=r.data[r.index];a=i?S(v)&&i in v?v[i]:l?a:v:B(v)?a:v}return(0,U.jsx)(ke.Consumer,{children:function(m){return(0,U.jsx)(ce,T()(T()({defaultValue:c},n),{},{parentField:m,initialValue:a,eachConfig:r,__Component__:f}))}})}})}}}var te=function(c){var f=c.children,n=(0,I.useContext)(X);if(!n||!f)return null;var e=n.keys,t=n.form,r=n.listInstance;return(0,U.jsx)(U.Fragment,{children:e.map(function(a,i){var s=T()(T()({},n),{},{form:V(t)?String(i):"".concat(t,".").concat(i),index:i,key:a,remove:r.removeItem.bind(r,i),add:r.addItem.bind(r),move:r.moveItem.bind(r)});return(0,U.jsx)(J.Provider,{value:s,children:f(s)},a)})})},he=function(o){ne()(f,o);var c=ie()(f);function f(n,e){var t;re()(this,f),t=c.call(this,n,e),g()(F()(t),"deleteIndex",[]),g()(F()(t),"uuid",0),g()(F()(t),"fieldType",K.List);var r=F()(t),a=n.formList;return r.genID=r.genID.bind(r),r.addItem=r.addItem.bind(r),r.removeItem=r.removeItem.bind(r),r.moveItem=r.moveItem.bind(r),r.state=r.initState(),a&&a.__REF__&&(a.__REF__.current=r),t}return ae()(f,[{key:"initState",value:function(){var e=this,t=e.props,r=e.context;e._initID();var a=t.initRows,i=t.initialValue,s=e.getFormName(t);r&&r.initialValue&&(V(s)?b(r.initialValue)&&(i=r.initialValue):i=H(r.initialValue,s,i));var l=Array(a),u=i;b(i)&&u.length&&(a=u.length,l=u);var d=Array(a).fill(1).map(e.genID);return{keys:d,data:l}}},{key:"_initID",value:function(){this.uuid=1e3}},{key:"genID",value:function(){return"CC".concat(++this.uuid)}},{key:"getFormName",value:function(e){var t=e.form,r=e.eachConfig;return r?t?"".concat(r.form,".").concat(t):r.form:t}},{key:"setData",value:function(e){var t=this,r=t.props.initRows,a=t.state.keys;$(e)||!b(e)?e=[]:e.length===0&&(e=Array(r)),t.removeOutData(e.length),a=a.slice(0,e.length),t.setState({keys:a,data:e})}},{key:"getData",value:function(){return this.state.data}},{key:"addItem",value:function(e,t){var r,a=this,i=a.genID(),s=a.state,l=s.data,u=s.keys;u=Array.from(u),!$(t)&&t<l.length?(u.splice(t,0,i),l.splice(t,0,e),a.removeListData(t,1)):(u.push(i),l.push(e)),a.setState({keys:u,data:l}),(r=a.context)===null||r===void 0||r.formInstance.formChange()}},{key:"removeItem",value:function(e){var t=this,r=t.state,a=r.data,i=r.keys,s=i.length,l=(b(e)?e:[e]).filter(function(d){return d<s});if(l.length){var u;(u=t.deleteIndex).push.apply(u,Oe()(l)),t.removeListData(s-l.length,l.length),i=Array.from(i),l.forEach(function(d,v){i.splice(d-v,1),a.splice(d-v,1)}),t.setState({keys:i,data:a})}}},{key:"moveItem",value:function(e,t){var r=this,a=r.state,i=a.data,s=a.keys;if(e!==t&&e>=0&&e<s.length&&t>=0&&t<s.length){var l;s=Array.from(s);var u=s[e],d=i[e];s.splice(e,1),s.splice(t,0,u),i.splice(e,1),i.splice(t,0,d),r.setState({keys:s,data:i}),(l=r.context)===null||l===void 0||l.formInstance.formChange()}}},{key:"removeListData",value:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=this,a=r.getFormName(r.props),i=r.context,s=i.data,l=i.formInstance,u=e+t,d=[],v=e;v<u;v++)d.push(a?"".concat(a,".").concat(v):String(v));var h=function(C){d.forEach(function(E){C.indexOf(E)===0&&l.deleteField(C)})};for(var m in s)h(m)}},{key:"removeOutData",value:function(e){var t=this,r=t.getFormName(t.props),a=t.context,i=a.data,s=a.formInstance,l=r?Array(e).fill(1).map(function(u,d){return"".concat(r,".").concat(d)}):[];Object.keys(i).forEach(function(u){if(V(r)){var d=Number(u),v=u.substr(0,u.indexOf("."));String(d)===u&&d<e?s.deleteField(u,{isChange:!1}):/^[0-9]+$/.test(v)&&Number(v)>=e&&s.deleteField(u,{isChange:!1})}else u.indexOf(String(r))===0&&l.findIndex(function(h){return u.indexOf(h)!==-1})===-1&&s.deleteField(u,{isChange:!1})})}},{key:"getConfig",value:function(){return{form:this.getFormName(this.props)}}},{key:"componentDidMount",value:function(){var e;(e=this.context)===null||e===void 0||e.formInstance.setField(this)}},{key:"componentWillUnmount",value:function(){var e;(e=this.context)===null||e===void 0||e.formInstance.unmountField(this)}},{key:"shouldComponentUpdate",value:function(e,t){var r=this,a=r.props,i=r.state;return e.form!==a.form||t.keys!==i.keys||r.getFormName(e)!==r.getFormName(a)}},{key:"componentDidUpdate",value:function(e,t,r){if(t.keys!==this.state.keys){var a;(a=this.context)===null||a===void 0||a.formInstance.observeField()}}},{key:"render",value:function(){var e=this,t=e.context,r=e.getFormName(e.props),a=e.props.children,i=e.state,s=i.keys,l=i.data;if(!a||!b(s))return null;var u={form:r,listInstance:e,keys:s,data:l,length:s.length,formData:t.data},d=P(a)?(0,U.jsx)(te,{children:a}):a;return(0,U.jsx)(X.Provider,{value:u,children:d})}}]),f}(I.Component);g()(he,"contextType",L.Context),g()(he,"defaultProps",{initRows:1});var me=function(c){var f=(0,I.useContext)(J),n=c.form,e=c.initialValue,t=c.children,r=f;if(r){var a=r.data[r.index];e=n?S(a)&&n in a?a[n]:e:a}return(0,U.jsx)(he,T()(T()({},c),{},{initialValue:e,eachConfig:r,children:t}))};me.View=te;var xe=function(c){var f=c.children,n=(0,I.useContext)(X);if(!n)return null;var e=n.listInstance,t=T()(T()({},n),{},{remove:e.removeItem,add:e.addItem,move:e.moveItem});return(0,U.jsx)(U.Fragment,{children:f(t)})},vt=["children","forProps"];function ge(){return function(o){return(0,I.forwardRef)(function(c,f){return(0,U.jsx)(J.Consumer,{children:function(e){return(0,U.jsx)(L.Context.Consumer,{children:function(r){return(0,U.jsx)(o,T()(T()(T()({},c),{},{ref:f},r),{},{eachConfig:e||void 0}))}})}})})}}var Ne=ge()(function(o){var c=o.children,f=o.forProps,n=Ve()(o,vt);return(0,I.cloneElement)(c,f?f(n):n)});L.List=me,L.ListView=te,L.Field=Ue,L.Outlet=ge,L.OutletView=Ne,L.ListAction=xe}}]);
