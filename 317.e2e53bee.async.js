"use strict";(self.webpackChunkexample=self.webpackChunkexample||[]).push([[317],{8317:function(pt,De,C){C.r(De),C.d(De,{CCField:function(){return Ae},CCForm:function(){return L},CCList:function(){return pe},CCListAction:function(){return Ne},CCListView:function(){return ae},CCOutlet:function(){return ye},CCOutletView:function(){return Re}});var xe=C(3769),Ee=C.n(xe),je=C(5009),j=C.n(je),Me=C(4599),w=C.n(Me),qe=C(9289),B=C.n(qe),Pe=C(7857),S=C.n(Pe),We=C(5574),Ge=C.n(We),Be=C(2444),ne=C.n(Be),He=C(2004),ie=C.n(He),ze=C(5098),b=C.n(ze),Ze=C(1996),se=C.n(Ze),Ke=C(6037),oe=C.n(Ke),Xe=C(9783),y=C.n(Xe),I=C(7294),Je={visible:!0},ue=(0,I.createContext)(null),Q=(0,I.createContext)(null),Y=(0,I.createContext)(null),ke=(0,I.createContext)(Je),Qe=C(9632),Oe=C.n(Qe),_=function(d){return{subData:function(n){var e;return(e=d.current)===null||e===void 0?void 0:e.subData(n)},validate:function(){var n;return(n=d.current)===null||n===void 0?void 0:n.validate()},asyncValidate:function(){var c=B()(j()().mark(function e(){var t;return j()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(t=d.current)===null||t===void 0?void 0:t.asyncValidate();case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},e)}));function n(){return c.apply(this,arguments)}return n}(),validateErrors:function(n){var e;return(e=d.current)===null||e===void 0?void 0:e.validateErrors(n)},asyncValidateErrors:function(){var c=B()(j()().mark(function e(t){var r;return j()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",(r=d.current)===null||r===void 0?void 0:r.asyncValidateErrors(t));case 1:case"end":return i.stop()}},e)}));function n(e){return c.apply(this,arguments)}return n}(),setOriginData:function(n){var e;return(e=d.current)===null||e===void 0?void 0:e.setOriginData(n)},setFieldData:function(n){var e;return(e=d.current)===null||e===void 0?void 0:e.setFieldData(n)},addData:function(n){var e;return(e=d.current)===null||e===void 0?void 0:e.addData(n)},setData:function(n){var e;return(e=d.current)===null||e===void 0?void 0:e.setData(n)},__REF__:d}},le=function(d){return{add:function(n,e){var t;return(t=d.current)===null||t===void 0?void 0:t.addItem(n,e)},remove:function(n){var e;return(e=d.current)===null||e===void 0?void 0:e.removeItem(n)},move:function(n,e){var t;return(t=d.current)===null||t===void 0?void 0:t.moveItem(n,e)},setData:function(n){var e;return(e=d.current)===null||e===void 0?void 0:e.setData(n)},getData:function(){var n;return(n=d.current)===null||n===void 0?void 0:n.getData()},getSize:function(){var n;return((n=d.current)===null||n===void 0?void 0:n.getData().length)||0},__REF__:d}},Ye=function(){return _((0,I.createRef)())},_e=function(){var d=(0,I.useRef)(null);return[(0,I.useMemo)(function(){return _(d)},[])]},et=function(){var d=(0,I.useContext)(ue),c=d.formInstance,n=(0,I.useRef)(c);return n.current=c,(0,I.useMemo)(function(){return _(n)},[])},tt=function(){return le((0,I.createRef)())},rt=function(){var d=(0,I.useRef)(null);return[(0,I.useMemo)(function(){return le(d)},[])]},at=function(){var d=(0,I.useContext)(Q),c=d.listInstance,n=(0,I.useRef)(c);return n.current=c,(0,I.useMemo)(function(){return le(n)},[])},P=C(865);function ee(o){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,c=null,n=null,e=function(r){n=r,c&&clearTimeout(c),c=setTimeout(function(){c=null,n&&n()},d)};return(0,P.N7)(o,{scheduler:e})}var nt=C(2677),ve=C.n(nt),H=Object.prototype.toString;function M(o){return typeof o=="function"}function yt(o){return typeof o=="number"||H.call(o)==="[object Number]"}function te(o){return typeof o=="string"||H.call(o)==="[object String]"}function it(o){return typeof o=="boolean"||H.call(o)==="[object Boolean]"}function T(o){var d=o&&o.constructor;return ve()(o)==="object"&&H.call(o)==="[object Object]"&&(!M(d)||M(d)&&d instanceof d&&H.call(d)==="[object Function]")}function Ie(o){return ve()(o)==="object"&&(H.call(o)==="[object Promise]"||Promise.resolve(o)===o)}function D(o){return Array.isArray(o)}function z(o){return typeof o=="undefined"}function st(o){return o===null}function $(o){return z(o)||st(o)}function E(o){return $(o)||!String(o).trim().length}function de(o){return $(o)||!T(o)||!Object.getOwnPropertyNames(o).length}function re(o){return $(o)||!D(o)||!o.length}function fe(o,d){var c=0;return o.indexOf("[")!==-1?o.replace(/(\w)\[+([\w.\s]*)]+/g,function(n,e,t){var r="[".concat(t.replace(/\./g,"_"),"_").concat(++c,"]");return t.indexOf(".")!==-1?(d[r]=t,"".concat(e,".").concat(r)):"".concat(e,".").concat(t)}):o}function ce(o,d,c){if($(o)||E(d))return c;if(T(o)||D(o)){var n=o,e={};if(d in o)n=o[d];else{var t=fe(d,e).split("."),r=w()(t),a;try{for(r.s();!(a=r.n()).done;){var i=a.value;if(n=i in e?n[e[i]]:n[i],!n)break}}catch(s){r.e(s)}finally{r.f()}}return $(n)?c:n}else return o}function Z(o,d,c){if($(o)||E(d))return c;if(T(o)||D(o)){var n=o,e={};if(d in o)n=o[d];else for(var t=fe(String(d),e).split("."),r=0,a=t.length;r<a;r++){var i=t[r];if(T(n)||D(n)){var s=t.slice(r).join(".");if(s in n){n=s in e?n[e[s]]:n[s];break}}if(n=i in e?n[e[i]]:n[i],!n)break}return z(n)?c:n}else return o}function ot(o,d){var c=Object.create(null);(d||[]).forEach(function(e){var t=e.form,r=e.transform,a=e.inline,i=a===void 0?!0:a,s=ut(o[t]);if(M(r)?s=i&&D(s)?s.map(function(h,m){return r(h,o,m)}):r(s,o):E(r)||(s=i&&D(s)?s.map(function(h){return ce(h,r)}):ce(s,r)),t=t.replace(/@\w*/g,""),i)he(c,t,s);else{var u=t.lastIndexOf(".");if(u!==-1){var l=t.substr(0,u),f=t.substr(u+1),v=ce(c,l);s=T(s)?s:y()({},f,s),D(v)?s=v.push(s):T(v)&&(s=Object.assign(v,s)),he(c,l,s)}else T(s)?Object.assign(c,s):c[t]=s}});var n=Object.keys(c);return n.every(function(e){return/^([1-9]\d*|0)$/.test(e)})&&(c.length=n.length,c=Array.from(c).filter(function(e){return!$(e)})),c}function he(o,d,c){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},e=n.ks,t=e===void 0?{}:e,r=fe(d,t),a=r.indexOf(".");if(~a){var i=r.split("."),s=i[0],u=i.slice(1).join("."),l=o[s]||(u[0]==="0"?[]:Object.create(null)),f=he(l,u,c,S()({ks:t},n));l!==o[s]&&(o[s in t?t[s]:s]=f)}else(!D(o)||!$(c))&&(o[d in t?t[d]:d]=c);return o}function ut(o){return(0,P.bi)(o)?D(o)?Array.from(o):Object.assign({},o):o}function lt(o,d){return d&&d.target&&ve()(d.target)==="object"&&o in d.target?d.target[o]:d}function $e(o,d){if(D(o)&&D(d)){if(!d.length){var c=o;o=d,d=c}return d.some(function(n,e){return n!==o[e]})}else return d!==o}var N=C(5893),J;(function(o){o[o.Field=1]="Field",o[o.List=2]="List"})(J||(J={}));var W;(function(o){o[o.DEFAULT=0]="DEFAULT",o[o.SET=1]="SET"})(W||(W={}));function Le(o){return o.fieldType===J.Field}var L=function(o){se()(c,o);var d=oe()(c);function c(n){var e;ne()(this,c),e=d.call(this,n),y()(b()(e),"originData",void 0),y()(b()(e),"fieldStatus",P.LO({})),y()(b()(e),"changeState",W.DEFAULT),y()(b()(e),"fields",new Set),y()(b()(e),"fieldsMap",new Map),y()(b()(e),"removeFields",new Set),y()(b()(e),"updateFields",new Set),y()(b()(e),"listFields",new Set),y()(b()(e),"providerValue",{}),y()(b()(e),"timeoutChange",void 0),y()(b()(e),"timeoutErrorChange",void 0),y()(b()(e),"tempFields",void 0),y()(b()(e),"autoRunTime",void 0),y()(b()(e),"errorsMap",new Map);var t=b()(e),r=n.emitter,a=n.form;return t.state={data:P.LO({}),originData:{}},t.providerValue={formInstance:t,emitter:r},a&&a.__REF__&&(a.__REF__.current=t),e}return ie()(c,[{key:"componentWillUnmount",value:function(){this.unObserveField()}},{key:"shouldComponentUpdate",value:function(e,t){var r=this,a=e.disabled!==r.props.disabled;return a&&(r.providerValue=S()({},r.providerValue)),a||t.data!==r.state.data||e.children!==r.props.children}},{key:"getSnapshotBeforeUpdate",value:function(e,t){var r=this;return t.data!==r.state.data&&(r.unObserveField(),r.revertField(),r.revertListField()),null}},{key:"componentDidUpdate",value:function(e,t){var r=this;r.changeState=W.DEFAULT,t.data!==r.state.data&&r.observeField()}},{key:"revertListField",value:function(){var e=w()(this.listFields),t;try{for(e.s();!(t=e.n()).done;){var r=t.value,a=r.initState();r.removeOutData(a.data.length),r.setState(a)}}catch(i){e.e(i)}finally{e.f()}}},{key:"revertField",value:function(){var e=this,t=w()(e.fields),r;try{for(t.s();!(r=t.n()).done;){var a=r.value,i=a.initState(),s=a.getFormName();!E(s)&&!(s in e.state.data)&&e._setFieldValue(s,i.value,{raw:!0}),a.setState(i)}}catch(u){t.e(u)}finally{t.f()}}},{key:"unObserveField",value:function(){var e=w()(this.fields),t;try{for(e.s();!(t=e.n()).done;){var r=t.value;r.unObserveData()}}catch(a){e.e(a)}finally{e.f()}}},{key:"observeField",value:function(){var e=w()(this.fields),t;try{for(e.s();!(t=e.n()).done;){var r=t.value;r.observeData()}}catch(a){e.e(a)}finally{e.f()}}},{key:"fieldAutoRun",value:function(){var e=w()(this.updateFields),t;try{for(e.s();!(t=e.n()).done;){var r=t.value;r.observeData()}}catch(a){e.e(a)}finally{e.f()}this.updateFields.clear()}},{key:"handleChange",value:function(e){var t,r,a=this;(t=(r=a.props).onChange)===null||t===void 0||t.call(r,a.state.originData,e),a.changeState=W.DEFAULT}},{key:"fieldChange",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=this,i=r.raw,s=i===void 0?!1:i;E(e)||a.state.data[e]===t||(a._setFieldValue(e,t,{raw:s}),a.formChange(e))}},{key:"deleteField",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this,a=t.isChange,i=a===void 0?!0:a;$(e)||(delete P.LZ(r.state.data)[e],delete r.state.originData[e],i&&r.formChange(e))}},{key:"formChange",value:function(e){var t,r=this;clearTimeout(r.timeoutChange);var a=!E(e)&&((t=r.getField(e))===null||t===void 0?void 0:t.props);r.tempFields=r.tempFields||[],a&&r.tempFields.push(a),r.timeoutChange=setTimeout(function(){r.handleChange(r.tempFields),r.tempFields=[]})}},{key:"errorsChange",value:function(e,t){var r=this,a=r.props.onErrorChange;r.errorsMap.set(e,{key:e,messages:t}),a&&(clearTimeout(r.timeoutErrorChange),r.timeoutErrorChange=setTimeout(function(){var i=[];r.errorsMap.forEach(function(s){var u;(u=s.messages)!==null&&u!==void 0&&u.length&&i.push(s)}),a(i)}))}},{key:"_setFieldValue",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=r.raw,i=a===void 0?!1:a;if(!E(e)){var s=this.state.data;(i?P.LZ(s):s)[e]=t,this.state.originData[e]=t}}},{key:"setFieldStatus",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=r.raw,i=a===void 0?!1:a;if(!E(e)){var s=t.disabled,u=t.required,l=t.error,f=t.visible;(i?P.LZ(this.fieldStatus):this.fieldStatus)[e]={disabled:s,visible:f,required:u,validate:$(l)?void 0:!l}}}},{key:"setField",value:function(e){var t=this;if(Le(e)){var r=e.getFormName();E(r)||t.fieldsMap.set(r,e),t.fields.add(e),t._setFieldValue(r,e.value,{raw:!0}),t.setFieldStatus(r,e.getConfig(),{raw:!0}),t.updateFields.add(e),clearTimeout(t.autoRunTime),t.autoRunTime=setTimeout(function(){return t.fieldAutoRun()})}else t.listFields.add(e)}},{key:"renameField",value:function(e,t){this.fieldsMap.set(e,t)}},{key:"getField",value:function(e){return E(e)?null:this.fieldsMap.get(e)}},{key:"unmountField",value:function(e){var t=this;if(Le(e)){var r=e.getFormName();e.unObserveData(),t.fields.delete(e),t.removeFields.add(e),!E(r)&&t.fieldsMap.delete(r)}else t.listFields.delete(e)}},{key:"setOriginData",value:function(e){var t=this;t.originData=e;var r=w()(t.listFields),a;try{for(r.s();!(a=r.n()).done;){var i=a.value,s=i.getConfig(),u=s.form;if(E(u))D(e)&&i.setData(e);else{var l=Z(e,String(u));l&&i.setData(l)}}}catch(f){r.e(f)}finally{r.f()}t.setData(e,{isGet:!0,isChange:!1})}},{key:"setFieldData",value:function(e){this.setData(e,{isGet:!0,isChange:!0})}},{key:"setData",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this;if(!$(e)){var a=t.isGet,i=a===void 0?!1:a,s=t.isChange,u=s===void 0?!1:s;r.changeState=W.SET;var l=0,f=function(){setTimeout(function(){l--,l<=0&&(r.changeState=W.DEFAULT)})},v=w()(r.fields),h;try{for(v.s();!(h=v.n()).done;){var m=h.value,p=m.getConfig(),F=p.form,g=p.convertValue,A=p.alias;if(F){for(var k=Symbol(),O=k,U=0,R=[F].concat(Oe()(A));U<R.length;U++){var x=R[U],V=Z(e,x,k);V!==k&&(O=V,F=x)}if(k===O)continue;O=i&&M(g)?m.execGetValue(F,O,e):O,l++,u?m.handleChange(O,f):m.setValue(O,f)}}}catch(q){v.e(q)}finally{v.f()}l===0&&(r.changeState=W.DEFAULT)}}},{key:"addData",value:function(e){for(var t in e)e.hasOwnProperty(t)&&this._setFieldValue(t,e[t])}},{key:"validate",value:function(){return this.validateErrors().length===0}},{key:"asyncValidate",value:function(){var n=B()(j()().mark(function t(){return j()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.asyncValidateErrors();case 2:return a.t0=a.sent.length,a.abrupt("return",a.t0===0);case 4:case"end":return a.stop()}},t,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"validateErrors",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=new Map;return this._validateErrors(t,function(r,a){return a(r.validateErrors())},e),Array.from(t.values())}},{key:"asyncValidateErrors",value:function(){var n=B()(j()().mark(function t(){var r=this,a,i=arguments;return j()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return a=i.length>0&&i[0]!==void 0?i[0]:[],u.abrupt("return",new Promise(function(l){var f=new Map,v=0,h=0,m=r._validateErrors(f,function(p,F){v++,B()(j()().mark(function g(){return j()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.t0=F,k.next=3,p.asyncValidateErrors();case 3:k.t1=k.sent,(0,k.t0)(k.t1),h++,h===v&&l(Array.from(f.values()));case 7:case"end":return k.stop()}},g)}))()},a);!m&&l([])}));case 2:case"end":return u.stop()}},t)}));function e(){return n.apply(this,arguments)}return e}()},{key:"_validateErrors",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=this,i=!1,s=w()(this.fields),u;try{var l=function(){var v=u.value,h=v.getConfig();!E(h.form)&&h.visible&&h.parentVisible&&(!r.length||r.findIndex(function(m){return String(h.form).indexOf(String(m))===0})!==-1)&&(i=!0,t(v,function(m){var p=m.error,F=m.errors,g={key:h.form,messages:F};p&&e.set(h.form,g),a.errorsMap.set(String(h.form),g)}))};for(s.s();!(u=s.n()).done;)l()}catch(f){s.e(f)}finally{s.f()}return i}},{key:"subData",value:function(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=this,a=t.merge,i=a===void 0?!1:a,s=[],u=[],l=r.state,f=l.data,v=l.initialValue,h=w()(r.removeFields),m;try{for(h.s();!(m=h.n()).done;){var p=m.value,F=p.getConfig();F.form&&u.push(F.form)}}catch(G){h.e(G)}finally{h.f()}var g=w()(r.fields),A;try{for(g.s();!(A=g.n()).done;){var k=A.value,O=k.getConfig();O.form&&(u.push(O.form),!O.ignore&&O.parentVisible&&O.visible&&s.push(O))}}catch(G){g.e(G)}finally{g.f()}var U=ot(f,s);for(var R in f)!~u.indexOf(R)&&!(R in U)&&(U[R]=f[R]);var x=(e=r.originData)!==null&&e!==void 0?e:v;if(i&&x){var V=w()(r.listFields),q;try{var K=function(){var X=q.value,Ce=X.getConfig(),we=Ce.form,Fe=X.getData(),mt=X.deleteIndex,be=Z(U,String(we));we&&be&&Fe&&T(Fe[0])&&Fe.forEach(function(gt,Ve){mt.includes(Ve)||(be[Ve]=Object.assign({},gt,be[Ve]))})};for(V.s();!(q=V.n()).done;)K()}catch(G){V.e(G)}finally{V.f()}return Object.assign({},x,U)}return U}},{key:"data",get:function(){return this.state.data}},{key:"render",value:function(){var e=this,t=e.props.disabled,r=t===void 0?!1:t,a=e.state,i=a.data,s=a.originData,u=a.initialValue,l=e.providerValue;return l.data=i,l.originData=s,l.initialValue=u,l.disabled=r,l.fieldStatus=e.fieldStatus,(0,N.jsx)(ue.Provider,{value:l,children:e.props.children})}}],[{key:"getDerivedStateFromProps",value:function(e,t){var r=e.data,a=e.initialValue;return r&&r!==t.originData?{data:P.LO(r),originData:r}:a&&a!==t.initialValue?{data:P.LO({}),originData:{},initialValue:a}:null}}]),c}(I.Component);y()(L,"Context",ue),y()(L,"useForm",_e),y()(L,"useFormInstance",et),y()(L,"useList",rt),y()(L,"useListInstance",at),y()(L,"createForm",Ye),y()(L,"createList",tt),y()(L,"Outlet",void 0),y()(L,"OutletView",void 0),y()(L,"List",void 0),y()(L,"Field",void 0),y()(L,"ListView",void 0),y()(L,"ListAction",void 0);var vt=["forwardRef","__Component__","preserve","title","valuePropName","forValue","parentField","deliver"],Se="id",Ue=!0,dt=!0,Te=!0,ft=!1,ct=!1,me=function(o){se()(c,o);var d=oe()(c);function c(n,e){var t,r;ne()(this,c),r=d.call(this,n,e),y()(b()(r),"formInstance",void 0),y()(b()(r),"changeFlag",!1),y()(b()(r),"changeForm",!1),y()(b()(r),"isObserveUnion",!1),y()(b()(r),"unmount",!1),y()(b()(r),"observeReactions",[]),y()(b()(r),"providerValue",{}),y()(b()(r),"fieldType",J.Field);var a=b()(r);return a.listenerValueChange=a.listenerValueChange.bind(a),a.onChange=a.onChange.bind(a),a.observeVisible=a.observeVisible.bind(a),a.observeDisabled=a.observeDisabled.bind(a),a.observeRequired=a.observeRequired.bind(a),a.formInstance=_({current:(t=e==null?void 0:e.formInstance)!==null&&t!==void 0?t:null}),a.state=a.initState(),a.providerValue={fieldInstance:a},r}return ie()(c,[{key:"initState",value:function(){var e=this,t=e.props,r=e.context,a=t.initialValue,i=t.convertValue,s=t.defaultValue,u=t.visible,l=t.disabled,f=e.getFormName(t),v={},h=z(a)?s:a;!E(f)&&r&&(r.initialValue&&(v=r.initialValue,h=Z(r.initialValue,f,h)),r.data&&f in r.data&&!z(r.data[f])&&(h=r.data[f]));var m=e.getOptions(),p=m.options,F=m.data,g=e.findRequired(F,p),A=g.required,k=g.message,O={value:M(i)?e.execGetValue(f,h,v):h,initialValue:h,visible:$(u)?!0:!!e.execCallback(u,F,p),disabled:$(l)?!1:!!e.execCallback(l,F,p),required:A,requiredMsg:k,_refreshMark:{}};return e.changeFlag=!1,e.changeForm=!1,e.isObserveUnion=!1,O}},{key:"getFormName",value:function(e){var t=e||this.props,r=t.form,a=t.eachConfig,i=t.injectListName;return a&&i?typeof r!="number"&&r?"".concat(a.form,".").concat(r):a.form:r}},{key:"getFormAlias",value:function(e){var t=e||this.props,r=t.alias,a=t.eachConfig;return E(r)?[]:(r=D(r)?r:[r],r.map(function(i){return a?i?"".concat(a.form,".").concat(i):a.form:i}))}},{key:"findRequired",value:function(e,t){var r=this,a=r.props.rules;if(!$(a)){a=T(a)?[a]:a;var i=function(l){return T(l)&&!!r.execCallback(l.required,e,t)};if(D(a)){var s=a.find(i);return{required:!!(s!=null&&s.required),message:s==null?void 0:s.message}}else return{required:r.execCallback(a,e,t)===!0}}return{required:!1}}},{key:"execGetValue",value:function(e,t,r){var a=this.props,i=a.convertValue,s=a.eachConfig,u=a.inline;if(!u&&!E(e)){var l=String(e),f=s&&s.form?s.form:l.substring(0,l.lastIndexOf(".")),v=E(f)?r:Z(r,f);t=v!=null?v:t}try{return i(t)}catch(h){console.warn("ConvertValue:",h)}}},{key:"observeData",value:function(){var e=this;e.unObserveData(),e.observeReactions.push(ee(e.observeVisible),ee(e.observeDisabled),ee(e.observeRequired)),e.observeUnion()}},{key:"unObserveData",value:function(){this.observeReactions.forEach(function(e){return P.p_(e)}),this.observeReactions=[]}},{key:"getOptions",value:function(){var e=this,t=e.props.eachConfig||{},r=t.form,a=t.data,i=e.state||{},s=i.value,u=i.disabled,l=i.visible,f=i.error,v=i.required,h=e.context,m=h.data,p=h.originData,F=h.fieldStatus,g={form:r,val:s,data:p,status:F,selfStatus:{disabled:u,visible:l,required:v,validate:$(f)?void 0:!f},listData:a};return{options:g,data:m,originData:p}}},{key:"observeDisabled",value:function(){var e=this;if(!e.unmount){var t=e.props.disabled,r=e.getOptions(),a=r.options,i=r.data;$(t)||(e.disabled=!!e.execCallback(t,i,a))}}},{key:"observeVisible",value:function(){var e=this;if(!e.unmount){var t=e.props.visible,r=e.getOptions(),a=r.options,i=r.data;$(t)||(e.visible=!!e.execCallback(t,i,a))}}},{key:"observeRequired",value:function(){var e=this;if(!e.unmount){var t=e.getOptions(),r=t.options,a=t.data,i=e.findRequired(a,r),s=i.required,u=i.message;e.required=s,e.requiredMsg=u}}},{key:"observeUnion",value:function(){var e=this;e.isObserveUnion=!1;var t=e.context,r=e.getUnionList();if(!(e.unmount||re(r))){var a=e.props,i=a.unionValue,s=a.unionValidate,u=t.formInstance,l=e.getFormName();i=M(i)?i:function(){return s?e.value:void 0};var f=function v(h){var m,p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],F=((m=u.getField(h))===null||m===void 0?void 0:m.getUnionList())||[];return F.forEach(function(g){var A=D(g)?g[0]:g;p.indexOf(A)===-1&&(p.push(A),v(A,p))}),p};r.forEach(function(v){var h=D(v)?v:[v,i],m=Ge()(h,2),p=m[0],F=m[1],g=f(p,[p]),A=ee(function(){var k=e.getOptions(),O=k.options,U=k.data,R=k.originData,x=e.execCallback(F,U[p],S()(S()({},O),{},{data:R})),V=!1,q=function(){var G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},X=G.valid,Ce=X===void 0?!1:X;!e.unmount&&p in U&&e.handleChange(x,function(){Ce&&s&&e.unionValidateErrors()})};e.isObserveUnion&&(u==null?void 0:u.changeState)!==W.SET?(V=!0,q({valid:!0})):g.forEach(function(K){return U[K]}),!V&&$(l)&&q()});e.observeReactions.push(A)}),e.isObserveUnion=!0}}},{key:"getUnionList",value:function(){var e=this,t=e.props.union;if(E(t))return null;var r=e.getOptions(),a=r.options;return t=M(t)?t(a):t,E(t)?null:(t=D(t)?t:t.split(","),t)}},{key:"execCallback",value:function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return M(e)?e.apply(void 0,r):e}catch(i){console.warn(i)}}},{key:"getTitle",value:function(){var e=this,t=e.getOptions(),r=t.options,a=t.data;return e.execCallback(e.props.title,a,r)}},{key:"getConfig",value:function(e,t){var r=this;e=e||r.props,t=t||r.state;var a=e,i=a.inline,s=a.transform,u=a.ignore,l=a.convertValue,f=a.parentField,v=t,h=v.disabled,m=v.visible,p=v.error,F=v.required;return{inline:i,form:r.getFormName(e),alias:r.getFormAlias(e),transform:s,visible:m,parentVisible:f.visible,disabled:h,ignore:u,error:p,required:F,convertValue:l}}},{key:"onChange",value:function(e){var t=this,r=t.props,a=r.normalize,i=r.valuePropName,s=i===void 0?"value":i,u=t.context;e=lt(s,e);for(var l=arguments.length,f=new Array(l>1?l-1:0),v=1;v<l;v++)f[v-1]=arguments[v];t.handleChange(a?a(e,{val:t.state.value,data:u.data,args:f}):e)}},{key:"handleChange",value:function(e,t){var r,a=this;if(a.unmount||e===a.state.value){t==null||t();return}var i=a.context,s=a.props.listener,u=s===void 0?{}:s,l=u.key,f=u.transform;a.changeFlag=!0,a.changeForm=!0,l&&((r=i.emitter)===null||r===void 0||r.emit(l,f?f(e,i.data):e)),a.handleValue(e,t)}},{key:"setValue",value:function(e,t){this.changeForm=!0,this.handleValue(e,t)}},{key:"value",get:function(){return this.state.value}},{key:"handleValue",value:function(e,t){var r=this,a=r.state.value;!r.unmount&&!r.equalsValue(e,a)?r.setState({value:e},t):t==null||t()}},{key:"equalsValue",value:function(e,t){var r=this,a=r.props,i=a.label,s=a.unique,u=s===void 0?Se:s;if(e===t)return!0;var l=function(v,h){if(de(v)||de(h))return!1;var m,p;return u in v||u in h?(m=v[u],p=h[u]):i&&(i in v||i in h)&&(m=v[i],p=h[i]),r.equalsValue(m,p)};return T(e)||T(t)?l(e,t):D(e)||D(t)?re(e)||re(t)||e.length!==t.length?!1:e.every(function(f,v){return r.equalsValue(f,t[v])}):String(e)===String(t)}},{key:"disabled",set:function(e){e!==this.state.disabled&&this.setState({disabled:e})}},{key:"required",set:function(e){e!==this.state.required&&this.setState({required:e})}},{key:"requiredMsg",set:function(e){e!==this.state.requiredMsg&&this.setState({requiredMsg:e})}},{key:"visible",set:function(e){var t=this;e!==t.state.visible&&(e||t.setState({error:void 0,errors:void 0}),t.setState({visible:e}))}},{key:"validateErrors",value:function(){return this._validateErrors(this.validate())}},{key:"asyncValidateErrors",value:function(){return this._asyncValidateErrors()}},{key:"unionValidateErrors",value:function(){return this._asyncValidateErrors({isUnionValid:!0})}},{key:"_asyncValidateErrors",value:function(){var n=B()(j()().mark(function t(){var r,a,i,s,u,l,f,v,h,m,p=arguments;return j()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(r=p.length>0&&p[0]!==void 0?p[0]:{},a=this,i=r.isUnionValid,s=a.validate({async:!0,isUnionValid:i}),!D(s)){g.next=38;break}u=[],l=!0,f=w()(s),g.prev=8,f.s();case 10:if((v=f.n()).done){g.next=29;break}if(h=v.value,!Ie(h)){g.next=26;break}return m=void 0,g.prev=14,g.next=17,h;case 17:m=g.sent,g.next=23;break;case 20:g.prev=20,g.t0=g.catch(14),m=g.t0;case 23:te(m)?u.push(m):m||(l=!1),g.next=27;break;case 26:u.push(h);case 27:g.next=10;break;case 29:g.next=34;break;case 31:g.prev=31,g.t1=g.catch(8),f.e(g.t1);case 34:return g.prev=34,f.f(),g.finish(34);case 37:s=u.length?u:l;case 38:return g.abrupt("return",this._validateErrors(s));case 39:case"end":return g.stop()}},t,this,[[8,31,34,37],[14,20]])}));function e(){return n.apply(this,arguments)}return e}()},{key:"_validateErrors",value:function(e){var t=this,r=t.state,a=r.errors,i=r.error,s,u;return it(e)?(u=!e,s=void 0):(u=!!e.length,s=e),u!==i&&t.setState({error:u}),t.equalsValue(a,s)||t.setState({errors:s,_refreshMark:{}}),{error:u,errors:s}}},{key:"validate",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=this,r=e.async,a=r===void 0?!1:r,i=e.isUnionValid,s=i===void 0?!1:i,u=t.props.rules,l=t.state,f=l.required,v=l.requiredMsg,h=l.value,m=l.visible;if(!m)return!0;var p=s?!1:t.validateEmpty(h);if(f&&p)return E(v)?!1:[v];if(p)return!0;var F=t.getOptions(),g=F.options,A=F.originData,k=function(V){if(M(V))return V(A,S()(S()({},g),{},{isUnionValid:s}));if(!s){if(V&&V instanceof RegExp)return V.test(h);if(T(V)){var q=V.pattern,K=V.message;if(q&&!q.test(h))return K||!1}}return!0};if(D(u)){var O=[],U=!0;return u.forEach(function(x){var V=k(x);te(V)||a&&Ie(V)?O.push(V):V||(U=!1)}),O.length?O:U}else if(!s&&T(u)){var R=k(u);return te(R)?[R]:R}return!0}},{key:"validateEmpty",value:function(e){var t=this.props.label,r=function(i){return de(i)||!!(t&&E(i[t]))};return $(e)?!0:te(e)?E(e):T(e)?r(e):D(e)?re(e)||T(e[0])&&r(e[0]):$(e)}},{key:"listenerValueChange",value:function(e){var t=this,r=this.context,a=t.props.listener;t.handleValue(a!=null&&a.convertValue?a.convertValue(e,r.data):e)}},{key:"componentDidMount",value:function(){var e,t=this,r=t.context,a=t.props.listener,i=a===void 0?{}:a,s=i.key;s&&((e=r.emitter)===null||e===void 0||e.addListener(s,t.listenerValueChange)),r.formInstance.setField(t)}},{key:"componentWillUnmount",value:function(){var e,t=this;t.unmount=!0;var r=t.context,a=t.props.listener,i=a===void 0?{}:a,s=i.key;s&&((e=r.emitter)===null||e===void 0||e.removeListener(s,t.listenerValueChange)),r.formInstance.unmountField(t)}},{key:"shouldComponentUpdate",value:function(e,t){var r=this,a=r.props,i=r.state;return t.value!==i.value||t.required!==i.required||t.error!==i.error||t.visible!==i.visible||t.disabled!==i.disabled||t._refreshMark!==i._refreshMark||e.form!==a.form||r.getFormName(e)!==r.getFormName(a)||$e(a.shouldUpdate,e.shouldUpdate)}},{key:"getSnapshotBeforeUpdate",value:function(e,t){var r=this,a=this.context,i=a.formInstance,s=r.state,u=s.required,l=s.error,f=s.visible,v=s.disabled,h=r.getFormName(r.props),m=r.getFormName(e);return e.form!==this.props.form&&i.unmountField(this),h!==m&&!E(h)&&i.renameField(h,r),(u!==t.required||l!==t.error||f!==t.visible||v!==t.disabled)&&i.setFieldStatus(h,{required:u,error:l,visible:f,disabled:v}),null}},{key:"componentDidUpdate",value:function(e,t){var r=this,a=this.context,i=a.formInstance,s=r.state,u=s.value,l=s.required,f=s.error,v=s.errors,h=r.getFormName(r.props);if(u!==t.value){var m,p;i.fieldChange(h,u,{raw:!r.changeForm}),r.changeFlag&&((m=(p=r.props).onChange)===null||m===void 0||m.call(p,u))}(u!==t.value&&r.changeFlag||l!==t.required&&!l&&!$(f))&&r.asyncValidateErrors(),e.form!==r.props.form&&i.setField(r),h!==r.getFormName(e)&&i.fieldChange(h,u,{raw:!0}),!E(h)&&v!==t.errors&&i.errorsChange(String(h),v),r.changeFlag=!1,r.changeForm=!1}},{key:"render",value:function(){var e=this,t=e.context,r=e.state,a=r.value,i=r.required,s=r.error,u=r.errors,l=r.disabled,f=r.visible,v=e.props,h=v.forwardRef,m=v.__Component__,p=v.preserve,F=v.title,g=v.valuePropName,A=v.forValue,k=v.parentField,O=v.deliver,U=Ee()(v,vt);if(!f&&!p)return null;var R=A?A(a,t.data):a;g&&(U[g]=R);var x=e.providerValue;x.visible=f;var V=(0,N.jsx)(m,S()(S()({},U),{},{title:e.getTitle(),data:t.data,value:R,required:i,disabled:t.disabled||l,visible:f,formInstance:e.formInstance,error:s,errors:u,onChange:e.onChange,ref:h}));return O?(0,N.jsx)(ke.Provider,{value:x,children:V}):V}}],[{key:"getDerivedStateFromProps",value:function(e,t){var r=null;function a(i){var s=e[i];!z(s)&&!M(s)&&s!==t["_".concat(i)]&&(r=r||{},r[i]=s,r["_".concat(i)]=s)}return["value","disabled","visible"].forEach(a),r}}]),c}(I.Component);y()(me,"contextType",L.Context),y()(me,"defaultProps",{inline:Ue,unique:Se,deliver:dt,injectListName:Te,preserve:ft,unionValidate:ct});function Ae(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=o.defaultValue;return function(c){return function(n){return(0,N.jsx)(Y.Consumer,{children:function(t){var r=t,a=n.initialValue,i=n.form,s=n.inline,u=s===void 0?Ue:s,l=n.injectListName,f=l===void 0?Te:l;if(r&&f){var v=r.data[r.index];a=i?T(v)&&i in v?v[i]:u?a:v:z(v)?a:v}return(0,N.jsx)(ke.Consumer,{children:function(m){return(0,N.jsx)(me,S()(S()({defaultValue:d},n),{},{parentField:m,initialValue:a,eachConfig:r,__Component__:c}))}})}})}}}var ae=function(d){var c=d.children,n=d.component,e=d.provider,t=(0,I.useContext)(Q);if(!t||!c)return null;var r=t.keys,a=t.form,i=t.listInstance,s=r.map(function(u,l){var f=S()(S()({},t),{},{form:E(a)?String(l):"".concat(a,".").concat(l),index:l,key:u,remove:i.removeItem.bind(i,l),add:i.addItem.bind(i),move:i.moveItem.bind(i)}),v=(0,N.jsx)(Y.Provider,{value:f,children:c(f)},u);return e?e(f,v):v});return n?n(t,s):(0,N.jsx)(N.Fragment,{children:s})},ge=function(o){se()(c,o);var d=oe()(c);function c(n,e){var t;ne()(this,c),t=d.call(this,n,e),y()(b()(t),"deleteIndex",[]),y()(b()(t),"uuid",0),y()(b()(t),"fieldType",J.List);var r=b()(t),a=n.formList;return r.genID=r.genID.bind(r),r.addItem=r.addItem.bind(r),r.removeItem=r.removeItem.bind(r),r.moveItem=r.moveItem.bind(r),r.state=r.initState(),a&&a.__REF__&&(a.__REF__.current=r),t}return ie()(c,[{key:"initState",value:function(){var e=this,t=e.props,r=e.context;e._initID();var a=t.initRows,i=t.initialValue,s=e.getFormName(t);r&&r.initialValue&&(E(s)?D(r.initialValue)&&(i=r.initialValue):i=Z(r.initialValue,s,i));var u=Array(a),l=i;D(i)&&l.length&&(a=l.length,u=l);var f=Array(a).fill(1).map(e.genID);return{keys:f,data:u}}},{key:"_initID",value:function(){this.uuid=1e3}},{key:"genID",value:function(){return"CC".concat(++this.uuid)}},{key:"getFormName",value:function(e){var t=e.form,r=e.eachConfig;return r?t?"".concat(r.form,".").concat(t):r.form:t}},{key:"setData",value:function(e){var t=this,r=t.props.initRows,a=t.state.keys;$(e)||!D(e)?e=[]:e.length===0&&(e=Array(r)),t.removeOutData(e.length),a=a.slice(0,e.length),t.setState({keys:a,data:e})}},{key:"getData",value:function(){return this.state.data}},{key:"addItem",value:function(e,t){var r,a=this,i=a.genID(),s=a.state,u=s.data,l=s.keys;l=Array.from(l),!$(t)&&t<u.length?(l.splice(t,0,i),u.splice(t,0,e),a.removeListData(t,1)):(l.push(i),u.push(e)),a.setState({keys:l,data:u}),(r=a.context)===null||r===void 0||r.formInstance.formChange()}},{key:"removeItem",value:function(e){var t=this,r=t.state,a=r.data,i=r.keys,s=i.length,u=(D(e)?e:[e]).filter(function(f){return f<s});if(u.length){var l;(l=t.deleteIndex).push.apply(l,Oe()(u)),t.removeListData(s-u.length,u.length),i=Array.from(i),u.forEach(function(f,v){i.splice(f-v,1),a.splice(f-v,1)}),t.setState({keys:i,data:a})}}},{key:"moveItem",value:function(e,t){var r=this,a=r.state,i=a.data,s=a.keys;if(e!==t&&e>=0&&e<s.length&&t>=0&&t<s.length){var u;s=Array.from(s);var l=s[e],f=i[e];s.splice(e,1),s.splice(t,0,l),i.splice(e,1),i.splice(t,0,f),r.setState({keys:s,data:i}),(u=r.context)===null||u===void 0||u.formInstance.formChange()}}},{key:"removeListData",value:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=this,a=r.getFormName(r.props),i=r.context,s=i.data,u=i.formInstance,l=e+t,f=[],v=e;v<l;v++)f.push(a?"".concat(a,".").concat(v):String(v));var h=function(F){f.forEach(function(g){F.indexOf(g)===0&&u.deleteField(F)})};for(var m in s)h(m)}},{key:"removeOutData",value:function(e){var t=this,r=t.getFormName(t.props),a=t.context,i=a.data,s=a.formInstance,u=r?Array(e).fill(1).map(function(l,f){return"".concat(r,".").concat(f)}):[];Object.keys(i).forEach(function(l){if(E(r)){var f=Number(l),v=l.substr(0,l.indexOf("."));String(f)===l&&f<e?s.deleteField(l,{isChange:!1}):/^[0-9]+$/.test(v)&&Number(v)>=e&&s.deleteField(l,{isChange:!1})}else l.indexOf(String(r))===0&&u.findIndex(function(h){return l.indexOf(h)!==-1})===-1&&s.deleteField(l,{isChange:!1})})}},{key:"getConfig",value:function(){return{form:this.getFormName(this.props)}}},{key:"componentDidMount",value:function(){var e;(e=this.context)===null||e===void 0||e.formInstance.setField(this)}},{key:"componentWillUnmount",value:function(){var e;(e=this.context)===null||e===void 0||e.formInstance.unmountField(this)}},{key:"shouldComponentUpdate",value:function(e,t){var r=this,a=r.props,i=r.state;return e.form!==a.form||t.keys!==i.keys||r.getFormName(e)!==r.getFormName(a)||$e(a.shouldUpdate,e.shouldUpdate)}},{key:"componentDidUpdate",value:function(e,t,r){if(t.keys!==this.state.keys){var a;(a=this.context)===null||a===void 0||a.formInstance.observeField()}}},{key:"render",value:function(){var e=this,t=e.context,r=e.getFormName(e.props),a=e.props.children,i=e.state,s=i.keys,u=i.data;if(!a||!D(s))return null;var l={form:r,listInstance:e,keys:s,data:u,length:s.length,formData:t.data},f=M(a)?(0,N.jsx)(ae,{children:a}):a;return(0,N.jsx)(Q.Provider,{value:l,children:f})}}]),c}(I.Component);y()(ge,"contextType",L.Context),y()(ge,"defaultProps",{initRows:1});var pe=function(d){var c=(0,I.useContext)(Y),n=d.form,e=d.initialValue,t=d.children,r=c;if(r){var a=r.data[r.index];e=n?T(a)&&n in a?a[n]:e:a}return(0,N.jsx)(ge,S()(S()({},d),{},{initialValue:e,eachConfig:r,children:t}))};pe.View=ae;var Ne=function(d){var c=d.children,n=(0,I.useContext)(Q);if(!n)return null;var e=n.listInstance,t=S()(S()({},n),{},{remove:e.removeItem,add:e.addItem,move:e.moveItem});return(0,N.jsx)(N.Fragment,{children:c(t)})},ht=["children","forProps"];function ye(){return function(o){return(0,I.forwardRef)(function(d,c){return(0,N.jsx)(Y.Consumer,{children:function(e){return(0,N.jsx)(L.Context.Consumer,{children:function(r){return(0,N.jsx)(o,S()(S()(S()({},d),{},{ref:c},r),{},{eachConfig:e||void 0}))}})}})})}}var Re=ye()(function(o){var d=o.children,c=o.forProps,n=Ee()(o,ht);return(0,I.cloneElement)(d,c?c(n):n)});L.List=pe,L.ListView=ae,L.Field=Ae,L.Outlet=ye,L.OutletView=Re,L.ListAction=Ne}}]);
