"use strict";(self.webpackChunkexample=self.webpackChunkexample||[]).push([[317],{8317:function(ht,De,p){p.r(De),p.d(De,{CCField:function(){return xe},CCForm:function(){return $},CCList:function(){return me},CCListAction:function(){return Ue},CCListView:function(){return te},CCOutlet:function(){return ge},CCOutletView:function(){return Re}});var Ne=p(3769),Ve=p.n(Ne),Ae=p(5009),w=p.n(Ae),je=p(4599),j=p.n(je),we=p(9289),W=p.n(we),Me=p(7857),N=p.n(Me),Pe=p(5574),qe=p.n(Pe),Ge=p(2444),re=p.n(Ge),We=p(2004),ae=p.n(We),Be=p(5098),O=p.n(Be),He=p(1996),ne=p.n(He),ze=p(6037),ie=p.n(ze),Ke=p(9783),g=p.n(Ke),E=p(7294),Xe={visible:!0},se=(0,E.createContext)(null),Z=(0,E.createContext)(null),J=(0,E.createContext)(null),Oe=(0,E.createContext)(Xe),Ze=p(9632),ke=p.n(Ze),Q=function(c){return{subData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.subData(n)},validate:function(){var n;return(n=c.current)===null||n===void 0?void 0:n.validate()},asyncValidate:function(){var f=W()(w()().mark(function e(){var t;return w()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(t=c.current)===null||t===void 0?void 0:t.asyncValidate();case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},e)}));function n(){return f.apply(this,arguments)}return n}(),validateErrors:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.validateErrors(n)},asyncValidateErrors:function(){var f=W()(w()().mark(function e(t){var r;return w()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",(r=c.current)===null||r===void 0?void 0:r.asyncValidateErrors(t));case 1:case"end":return i.stop()}},e)}));function n(e){return f.apply(this,arguments)}return n}(),setOriginData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.setOriginData(n)},setFieldData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.setFieldData(n)},addData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.addData(n)},setData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.setData(n)},__REF__:c}},oe=function(c){return{add:function(n,e){var t;return(t=c.current)===null||t===void 0?void 0:t.addItem(n,e)},remove:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.removeItem(n)},move:function(n,e){var t;return(t=c.current)===null||t===void 0?void 0:t.moveItem(n,e)},setData:function(n){var e;return(e=c.current)===null||e===void 0?void 0:e.setData(n)},getData:function(){var n;return(n=c.current)===null||n===void 0?void 0:n.getData()},getSize:function(){var n;return((n=c.current)===null||n===void 0?void 0:n.getData().length)||0},__REF__:c}},Je=function(){return Q((0,E.createRef)())},Qe=function(){var c=(0,E.useRef)(null);return[(0,E.useMemo)(function(){return Q(c)},[])]},Ye=function(){var c=(0,E.useContext)(se),f=c.formInstance,n=(0,E.useRef)(f);return n.current=f,(0,E.useMemo)(function(){return Q(n)},[])},_e=function(){return oe((0,E.createRef)())},et=function(){var c=(0,E.useRef)(null);return[(0,E.useMemo)(function(){return oe(c)},[])]},tt=function(){var c=(0,E.useContext)(Z),f=c.listInstance,n=(0,E.useRef)(f);return n.current=f,(0,E.useMemo)(function(){return oe(n)},[])},P=p(865);function Y(o){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,f=null,n=null,e=function(r){n=r,f&&clearTimeout(f),f=setTimeout(function(){f=null,n&&n()},c)};return(0,P.N7)(o,{scheduler:e})}var rt=p(2677),ue=p.n(rt),K=Object.prototype.toString;function q(o){return typeof o=="function"}function mt(o){return typeof o=="number"||K.call(o)==="[object Number]"}function _(o){return typeof o=="string"||K.call(o)==="[object String]"}function at(o){return typeof o=="boolean"||K.call(o)==="[object Boolean]"}function S(o){return ue()(o)==="object"&&K.call(o)==="[object Object]"}function Ie(o){return ue()(o)==="object"&&(K.call(o)==="[object Promise]"||Promise.resolve(o)===o)}function D(o){return Array.isArray(o)}function B(o){return typeof o=="undefined"}function nt(o){return o===null}function L(o){return B(o)||nt(o)}function k(o){return L(o)||!String(o).trim().length}function le(o){return L(o)||!S(o)||!Object.getOwnPropertyNames(o).length}function ee(o){return L(o)||!D(o)||!o.length}function ve(o,c){var f=0;return o.indexOf("[")!==-1?o.replace(/(\w)\[+([\w.\s]*)]+/g,function(n,e,t){var r="[".concat(t.replace(/\./g,"_"),"_").concat(++f,"]");return t.indexOf(".")!==-1?(c[r]=t,"".concat(e,".").concat(r)):"".concat(e,".").concat(t)}):o}function de(o,c,f){if(L(o)||k(c))return f;if(S(o)||D(o)){var n=o,e={};if(c in o)n=o[c];else{var t=ve(c,e).split("."),r=j()(t),a;try{for(r.s();!(a=r.n()).done;){var i=a.value;if(n=i in e?n[e[i]]:n[i],!n)break}}catch(s){r.e(s)}finally{r.f()}}return L(n)?f:n}else return o}function H(o,c,f){if(L(o)||k(c))return f;if(S(o)||D(o)){var n=o,e={};if(c in o)n=o[c];else for(var t=ve(String(c),e).split("."),r=0,a=t.length;r<a;r++){var i=t[r];if(S(n)||D(n)){var s=t.slice(r).join(".");if(s in n){n=s in e?n[e[s]]:n[s];break}}if(n=i in e?n[e[i]]:n[i],!n)break}return B(n)?f:n}else return o}function it(o,c){var f=Object.create(null);(c||[]).forEach(function(e){var t=e.form,r=e.transform,a=e.inline,i=a===void 0?!0:a,s=st(o[t]);if(q(r)?s=D(s)?s.map(function(m,h){return r(m,o,h)}):r(s,o):k(r)||(s=D(s)?s.map(function(m){return de(m,r)}):de(s,r)),t=t.replace(/@\w*/g,""),i)fe(f,t,s);else{var l=t.lastIndexOf(".");if(l!==-1){var u=t.substr(0,l),d=t.substr(l+1),v=de(f,u);s=S(s)?s:g()({},d,s),D(v)?s=v.push(s):S(v)&&(s=Object.assign(v,s)),fe(f,u,s)}else S(s)?Object.assign(f,s):f[t]=s}});var n=Object.keys(f);return n.every(function(e){return/^([1-9]\d*|0)$/.test(e)})&&(f.length=n.length,f=Array.from(f).filter(function(e){return!L(e)})),f}function fe(o,c,f){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},e=n.ks,t=e===void 0?{}:e,r=ve(c,t),a=r.indexOf(".");if(~a){var i=r.split("."),s=i[0],l=i.slice(1).join("."),u=o[s]||(l[0]==="0"?[]:Object.create(null)),d=fe(u,l,f,N()({ks:t},n));u!==o[s]&&(o[s in t?t[s]:s]=d)}else(!D(o)||!L(f))&&(o[c in t?t[c]:c]=f);return o}function st(o){return(0,P.bi)(o)?D(o)?Array.from(o):Object.assign({},o):o}function ot(o,c){return c&&c.target&&ue()(c.target)==="object"&&o in c.target?c.target[o]:c}var x=p(5893),X;(function(o){o[o.Field=1]="Field",o[o.List=2]="List"})(X||(X={}));var M;(function(o){o[o.DEFAULT=0]="DEFAULT",o[o.SET=1]="SET"})(M||(M={}));function Ee(o){return o.fieldType===X.Field}var $=function(o){ne()(f,o);var c=ie()(f);function f(n){var e;re()(this,f),e=c.call(this,n),g()(O()(e),"originData",void 0),g()(O()(e),"changeState",M.DEFAULT),g()(O()(e),"fields",new Set),g()(O()(e),"fieldsMap",new Map),g()(O()(e),"removeFields",new Set),g()(O()(e),"updateFields",new Set),g()(O()(e),"listFields",new Set),g()(O()(e),"providerValue",{}),g()(O()(e),"timeoutChange",void 0),g()(O()(e),"tempFields",void 0),g()(O()(e),"autoRunTime",void 0);var t=O()(e),r=n.emitter,a=n.form;return t.state={data:P.LO({}),originData:{}},t.providerValue={formInstance:t,emitter:r},a&&a.__REF__&&(a.__REF__.current=t),e}return ae()(f,[{key:"componentWillUnmount",value:function(){this.unObserveField()}},{key:"shouldComponentUpdate",value:function(e,t){var r=this;return t.data!==r.state.data||e.children!==r.props.children||e.disabled!==r.props.disabled}},{key:"getSnapshotBeforeUpdate",value:function(e,t){var r=this;return t.data!==r.state.data&&(r.unObserveField(),r.revertField(),r.revertListField()),null}},{key:"componentDidUpdate",value:function(e,t){var r=this;r.changeState=M.DEFAULT,t.data!==r.state.data&&r.observeField()}},{key:"revertListField",value:function(){var e=j()(this.listFields),t;try{for(e.s();!(t=e.n()).done;){var r=t.value,a=r.initState();r.removeOutData(a.data.length),r.setState(a)}}catch(i){e.e(i)}finally{e.f()}}},{key:"revertField",value:function(){var e=this,t=j()(e.fields),r;try{for(t.s();!(r=t.n()).done;){var a=r.value,i=a.initState(),s=a.getFormName();!k(s)&&!(s in e.state.data)&&e._setFieldRawValue(s,i.value),a.setState(i)}}catch(l){t.e(l)}finally{t.f()}}},{key:"unObserveField",value:function(){var e=j()(this.fields),t;try{for(e.s();!(t=e.n()).done;){var r=t.value;r.unObserveData()}}catch(a){e.e(a)}finally{e.f()}}},{key:"observeField",value:function(){var e=j()(this.fields),t;try{for(e.s();!(t=e.n()).done;){var r=t.value;r.observeData()}}catch(a){e.e(a)}finally{e.f()}}},{key:"fieldAutoRun",value:function(){var e=j()(this.updateFields),t;try{for(e.s();!(t=e.n()).done;){var r=t.value;r.observeData()}}catch(a){e.e(a)}finally{e.f()}this.updateFields.clear()}},{key:"handleChange",value:function(e){var t,r,a=this;(t=(r=a.props).onChange)===null||t===void 0||t.call(r,a.state.originData,e),a.changeState=M.DEFAULT}},{key:"fieldChange",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=this,i=r.raw,s=i===void 0?!1:i;k(e)||a.state.data[e]===t||(s?a._setFieldRawValue(e,t):a._setFieldValue(e,t),a.formChange(e))}},{key:"deleteField",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this,a=t.isChange,i=a===void 0?!0:a;L(e)||(delete P.LZ(r.state.data)[e],delete r.state.originData[e],i&&r.formChange(e))}},{key:"formChange",value:function(e){var t,r=this;clearTimeout(r.timeoutChange);var a=!k(e)&&((t=r.getField(e))===null||t===void 0?void 0:t.props);r.tempFields=r.tempFields||[],a&&r.tempFields.push(a),r.timeoutChange=setTimeout(function(){r.handleChange(r.tempFields),r.tempFields=[]})}},{key:"_setFieldValue",value:function(e,t){k(e)||(this.state.data[e]=t,this.state.originData[e]=t)}},{key:"_setFieldRawValue",value:function(e,t){k(e)||(P.LZ(this.state.data)[e]=t,this.state.originData[e]=t)}},{key:"setField",value:function(e){var t=this;if(Ee(e)){var r=e.getFormName();k(r)||t.fieldsMap.set(r,e),t.fields.add(e),t._setFieldRawValue(r,e.value),t.updateFields.add(e),clearTimeout(t.autoRunTime),t.autoRunTime=setTimeout(function(){return t.fieldAutoRun()})}else t.listFields.add(e)}},{key:"renameField",value:function(e,t){this.fieldsMap.set(e,t)}},{key:"getField",value:function(e){return k(e)?null:this.fieldsMap.get(e)}},{key:"unmountField",value:function(e){var t=this;if(Ee(e)){var r=e.getFormName();e.unObserveData(),t.fields.delete(e),t.removeFields.add(e),!k(r)&&t.fieldsMap.delete(r)}else t.listFields.delete(e)}},{key:"setOriginData",value:function(e){var t=this;t.originData=e;var r=j()(t.listFields),a;try{for(r.s();!(a=r.n()).done;){var i=a.value,s=i.getConfig(),l=s.form;if(k(l))D(e)&&i.setData(e);else{var u=H(e,String(l));u&&i.setData(u)}}}catch(d){r.e(d)}finally{r.f()}t.setData(e,{isGet:!0,isChange:!1})}},{key:"setFieldData",value:function(e){this.setData(e,{isGet:!0,isChange:!0})}},{key:"setData",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this;if(!L(e)){var a=t.isGet,i=a===void 0?!1:a,s=t.isChange,l=s===void 0?!1:s;r.changeState=M.SET;var u=0,d=function(){setTimeout(function(){u--,u<=0&&(r.changeState=M.DEFAULT)})},v=j()(r.fields),m;try{for(v.s();!(m=v.n()).done;){var h=m.value,b=h.getConfig(),V=b.form,y=b.convertValue,U=b.alias;if(V){for(var F=Symbol(),C=F,R=0,T=[V].concat(ke()(U));R<T.length;R++){var A=T[R],I=H(e,A,F);I!==F&&(C=I,V=A)}if(F===C)continue;C=i&&q(y)?h.execGetValue(V,C,e):C,u++,l?h.handleChange(C,d):h.setValue(C,d)}}}catch(G){v.e(G)}finally{v.f()}u===0&&(r.changeState=M.DEFAULT)}}},{key:"addData",value:function(e){for(var t in e)e.hasOwnProperty(t)&&this._setFieldValue(t,e[t])}},{key:"validate",value:function(){return this.validateErrors().length===0}},{key:"asyncValidate",value:function(){var n=W()(w()().mark(function t(){return w()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.asyncValidateErrors();case 2:return a.t0=a.sent.length,a.abrupt("return",a.t0===0);case 4:case"end":return a.stop()}},t,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"validateErrors",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=new Map;return this._validateErrors(t,function(r,a){return a(r.validateErrors())},e),Array.from(t.values())}},{key:"asyncValidateErrors",value:function(){var n=W()(w()().mark(function t(){var r=this,a,i=arguments;return w()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return a=i.length>0&&i[0]!==void 0?i[0]:[],l.abrupt("return",new Promise(function(u){var d=new Map,v=0,m=0,h=r._validateErrors(d,function(b,V){v++,W()(w()().mark(function y(){return w()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.t0=V,F.next=3,b.asyncValidateErrors();case 3:F.t1=F.sent,(0,F.t0)(F.t1),m++,m===v&&u(Array.from(d.values()));case 7:case"end":return F.stop()}},y)}))()},a);!h&&u([])}));case 2:case"end":return l.stop()}},t)}));function e(){return n.apply(this,arguments)}return e}()},{key:"_validateErrors",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=!1,i=j()(this.fields),s;try{var l=function(){var d=s.value,v=d.getConfig();v.form&&v.visible&&v.parentVisible&&(!r.length||r.findIndex(function(m){return String(v.form).indexOf(String(m))===0})!==-1)&&(a=!0,t(d,function(m){var h=m.error,b=m.errors;h&&e.set(v.form,{key:v.form,ref:d,messages:b})}))};for(i.s();!(s=i.n()).done;)l()}catch(u){i.e(u)}finally{i.f()}return a}},{key:"subData",value:function(){var e,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=this,a=t.merge,i=a===void 0?!1:a,s=[],l=[],u=r.state,d=u.data,v=u.initialValue,m=j()(r.removeFields),h;try{for(m.s();!(h=m.n()).done;){var b=h.value,V=b.getConfig();V.form&&l.push(V.form)}}catch(z){m.e(z)}finally{m.f()}var y=j()(r.fields),U;try{for(y.s();!(U=y.n()).done;){var F=U.value,C=F.getConfig();C.form&&(l.push(C.form),!C.ignore&&C.parentVisible&&C.visible&&s.push(C))}}catch(z){y.e(z)}finally{y.f()}var R=it(d,s);for(var T in d)!~l.indexOf(T)&&!(T in R)&&(R[T]=d[T]);var A=(e=r.originData)!==null&&e!==void 0?e:v;if(i&&A){var I=j()(r.listFields),G;try{var pe=function(){var ye=G.value,dt=ye.getConfig(),Te=dt.form,Ce=ye.getData(),ft=ye.deleteIndex,be=H(R,String(Te));Te&&be&&Ce&&S(Ce[0])&&Ce.forEach(function(ct,Fe){ft.includes(Fe)||(be[Fe]=Object.assign({},ct,be[Fe]))})};for(I.s();!(G=I.n()).done;)pe()}catch(z){I.e(z)}finally{I.f()}return Object.assign({},A,R)}return R}},{key:"data",get:function(){return this.state.data}},{key:"render",value:function(){var e=this,t=e.props.disabled,r=t===void 0?!1:t,a=e.state,i=a.data,s=a.originData,l=a.initialValue,u=e.providerValue;return u.data=i,u.originData=s,u.initialValue=l,u.disabled=r,(0,x.jsx)(se.Provider,{value:u,children:e.props.children})}}],[{key:"getDerivedStateFromProps",value:function(e,t){var r=e.data,a=e.initialValue;return r&&r!==t.originData?{data:P.LO(r),originData:r}:a&&a!==t.initialValue?{data:P.LO({}),originData:{},initialValue:a}:null}}]),f}(E.Component);g()($,"Context",se),g()($,"useForm",Qe),g()($,"useFormInstance",Ye),g()($,"useList",et),g()($,"useListInstance",tt),g()($,"createForm",Je),g()($,"createList",_e),g()($,"Outlet",void 0),g()($,"OutletView",void 0),g()($,"List",void 0),g()($,"Field",void 0),g()($,"ListView",void 0),g()($,"ListAction",void 0);var ut=["forwardRef","__Component__","preserve","title","valuePropName","forValue","parentField","deliver"],$e="id",Le=!0,lt=!0,Se=!0,ce=function(o){ne()(f,o);var c=ie()(f);function f(n,e){var t,r;re()(this,f),r=c.call(this,n,e),g()(O()(r),"formInstance",void 0),g()(O()(r),"changeFlag",!1),g()(O()(r),"changeForm",!1),g()(O()(r),"isObserveUnion",!1),g()(O()(r),"unmount",!1),g()(O()(r),"observeReactions",[]),g()(O()(r),"providerValue",{}),g()(O()(r),"fieldType",X.Field);var a=O()(r);return a.listenerValueChange=a.listenerValueChange.bind(a),a.onChange=a.onChange.bind(a),a.observeVisible=a.observeVisible.bind(a),a.observeDisabled=a.observeDisabled.bind(a),a.observeRules=a.observeRules.bind(a),a.formInstance=Q({current:(t=e==null?void 0:e.formInstance)!==null&&t!==void 0?t:null}),a.state=a.initState(),a.providerValue={fieldInstance:a},r}return ae()(f,[{key:"initState",value:function(){var e=this,t=e.props,r=e.context,a=t.initialValue,i=t.convertValue,s=t.defaultValue,l=t.visible,u=t.disabled,d=e.getFormName(t),v={},m=B(a)?s:a;!k(d)&&r&&(r.initialValue&&(v=r.initialValue,m=H(r.initialValue,d,m)),r.data&&d in r.data&&!B(r.data[d])&&(m=r.data[d]));var h=e.getObserveOptions(),b=h.options,V=h.data,y=e.findRequired(V,b),U=y.required,F=y.message,C={value:q(i)?e.execGetValue(d,m,v):m,initialValue:m,visible:L(l)?!0:!!e.execCallback(l,V,b),disabled:L(u)?!1:!!e.execCallback(u,V,b),error:!1,required:U,requiredMsg:F,_refreshMark:{}};return e.changeFlag=!1,e.changeForm=!1,e.isObserveUnion=!1,C}},{key:"getFormName",value:function(e){var t=e||this.props,r=t.form,a=t.eachConfig,i=t.injectListName;return a&&i?typeof r!="number"&&r?"".concat(a.form,".").concat(r):a.form:r}},{key:"getFormAlias",value:function(e){var t=e||this.props,r=t.alias,a=t.eachConfig;return k(r)?[]:(r=D(r)?r:[r],r.map(function(i){return a?i?"".concat(a.form,".").concat(i):a.form:i}))}},{key:"findRequired",value:function(e,t){var r=this,a=r.props.rules;if(!L(a)){a=S(a)?[a]:a;var i=function(u){return S(u)&&!!r.execCallback(u.required,e,t)};if(D(a)){var s=a.find(i);return{required:!!(s!=null&&s.required),message:s==null?void 0:s.message}}else return{required:r.execCallback(a,e,t)===!0}}return{required:!1}}},{key:"execGetValue",value:function(e,t,r){var a=this.props,i=a.convertValue,s=a.eachConfig,l=a.inline;if(!l&&!k(e)){var u=String(e),d=s&&s.form?s.form:u.substring(0,u.lastIndexOf(".")),v=k(d)?r:H(r,d);t=v!=null?v:t}try{return i(t)}catch(m){console.warn("\u53D6\u503CGetValue\u5F02\u5E38:",m)}}},{key:"observeData",value:function(){var e=this;e.unObserveData(),e.observeReactions.push(Y(e.observeVisible),Y(e.observeDisabled),Y(e.observeRules)),e.observeUnion()}},{key:"unObserveData",value:function(){this.observeReactions.forEach(function(e){return P.p_(e)}),this.observeReactions=[]}},{key:"getObserveOptions",value:function(){var e=this,t=e.props.eachConfig,r=e.context,a=r.data,i=r.originData,s={};return t&&(s=t),{options:s,data:a,originData:i}}},{key:"observeDisabled",value:function(){var e=this;if(!e.unmount){var t=e.props.disabled,r=e.getObserveOptions(),a=r.options,i=r.data;a.val=e.value,L(t)||(e.disabled=!!e.execCallback(t,i,a))}}},{key:"observeVisible",value:function(){var e=this;if(!e.unmount){var t=e.props.visible,r=e.getObserveOptions(),a=r.options,i=r.data;a.val=e.value,L(t)||(e.visible=!!e.execCallback(t,i,a))}}},{key:"observeRules",value:function(){var e=this;if(!e.unmount){var t=e.getObserveOptions(),r=t.options,a=t.data;r.val=e.value;var i=e.findRequired(a,r),s=i.required,l=i.message;e.required=s,e.requiredMsg=l}}},{key:"observeUnion",value:function(){var e=this;e.isObserveUnion=!1;var t=e.context,r=e.getUnionList();if(!(e.unmount||ee(r))){var a=e.props.unionValue,i=e.getObserveOptions(),s=i.options,l=i.data,u=i.originData,d=t.formInstance,v=e.getFormName();a=q(a)?a:function(){};var m=function h(b){var V,y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],U=((V=d.getField(b))===null||V===void 0?void 0:V.getUnionList())||[];return U.forEach(function(F){var C=D(F)?F[0]:F;y.indexOf(C)===-1&&(y.push(C),h(C,y))}),y};r.forEach(function(h){var b=D(h)?h:[h,a],V=qe()(b,2),y=V[0],U=V[1],F=m(y,[y]),C=Y(function(){var R=e.execCallback(U,l[y],N()(N()({},s),{},{val:e.value,data:u})),T=function(){return!e.unmount&&y in l&&e.handleChange(R)};L(v)&&T(),e.isObserveUnion&&(d==null?void 0:d.changeState)!==M.SET?T():F.forEach(function(A){return l[A]})});e.observeReactions.push(C)}),e.isObserveUnion=!0}}},{key:"getUnionList",value:function(){var e=this,t=e.props.union;if(k(t))return null;var r=e.getObserveOptions(),a=r.options;return t=q(t)?t(a):t,k(t)?null:(t=D(t)?t:t.split(","),t)}},{key:"execCallback",value:function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return q(e)?e.apply(void 0,r):e}catch(i){console.warn(i)}}},{key:"getTitle",value:function(){var e=this,t=e.getObserveOptions(),r=t.options,a=t.data;return e.execCallback(e.props.title,a,r)}},{key:"getConfig",value:function(){var e=this,t=e.props,r=t.inline,a=t.transform,i=t.ignore,s=t.convertValue,l=t.parentField,u=e.state,d=u.disabled,v=u.visible;return{inline:r,form:e.getFormName(e.props),alias:e.getFormAlias(e.props),title:e.getTitle(),transform:a,visible:v,parentVisible:l.visible,disabled:d,ignore:i,convertValue:s}}},{key:"onChange",value:function(e){var t=this,r=t.props,a=r.normalize,i=r.valuePropName,s=i===void 0?"value":i,l=t.context;e=ot(s,e);for(var u=arguments.length,d=new Array(u>1?u-1:0),v=1;v<u;v++)d[v-1]=arguments[v];t.handleChange(a?a(e,{val:t.state.value,data:l.data,args:d}):e)}},{key:"handleChange",value:function(e,t){var r,a=this;if(!(a.unmount||e===a.state.value)){var i=a.context,s=a.props.listener,l=s===void 0?{}:s,u=l.key,d=l.transform;a.changeFlag=!0,a.changeForm=!0,u&&((r=i.emitter)===null||r===void 0||r.emit(u,d?d(e,i.data):e)),a.handleValue(e,t)}}},{key:"setValue",value:function(e,t){this.changeForm=!0,this.handleValue(e,t)}},{key:"value",get:function(){return this.state.value}},{key:"handleValue",value:function(e,t){var r=this,a=r.state.value;!r.unmount&&!r.equalsValue(e,a)?r.setState({value:e},t):t&&t()}},{key:"equalsValue",value:function(e,t){var r=this,a=r.props,i=a.label,s=a.unique,l=s===void 0?$e:s;if(e===t)return!0;var u=function(v,m){if(le(v)||le(m))return!1;var h,b;return l in v||l in m?(h=v[l],b=m[l]):i&&(i in v||i in m)&&(h=v[i],b=m[i]),r.equalsValue(h,b)};return S(e)||S(t)?u(e,t):D(e)||D(t)?ee(e)||ee(t)||e.length!==t.length?!1:e.every(function(d,v){return r.equalsValue(d,t[v])}):String(e)===String(t)}},{key:"disabled",set:function(e){e!==this.state.disabled&&this.setState({disabled:e})}},{key:"required",set:function(e){e!==this.state.required&&this.setState({required:e})}},{key:"requiredMsg",set:function(e){e!==this.state.requiredMsg&&this.setState({requiredMsg:e})}},{key:"visible",set:function(e){var t=this;e!==t.state.visible&&(e||t.setState({error:!1,errors:void 0}),t.setState({visible:e}))}},{key:"validateErrors",value:function(){return this._validateErrors(this.validate())}},{key:"asyncValidateErrors",value:function(){var n=W()(w()().mark(function t(){var r,a,i,s,l,u,d,v;return w()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(r=this,a=r.validate({async:!0}),!D(a)){h.next=36;break}i=[],s=!0,l=j()(a),h.prev=6,l.s();case 8:if((u=l.n()).done){h.next=27;break}if(d=u.value,!Ie(d)){h.next=24;break}return v=void 0,h.prev=12,h.next=15,d;case 15:v=h.sent,h.next=21;break;case 18:h.prev=18,h.t0=h.catch(12),v=h.t0;case 21:_(v)?i.push(v):v||(s=!1),h.next=25;break;case 24:i.push(d);case 25:h.next=8;break;case 27:h.next=32;break;case 29:h.prev=29,h.t1=h.catch(6),l.e(h.t1);case 32:return h.prev=32,l.f(),h.finish(32);case 35:a=i.length?i:s;case 36:return h.abrupt("return",this._validateErrors(a));case 37:case"end":return h.stop()}},t,this,[[6,29,32,35],[12,18]])}));function e(){return n.apply(this,arguments)}return e}()},{key:"_validateErrors",value:function(e){var t=this,r=t.state,a=r.errors,i=r.error,s,l;return at(e)?(l=!e,s=void 0):(l=!!e.length,s=e),l!==i&&t.setState({error:l}),t.equalsValue(a,s)||t.setState({errors:s,_refreshMark:{}}),{error:l,errors:s}}},{key:"validate",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=this,r=e.async,a=r===void 0?!1:r,i=t.context,s=t.props,l=s.ignore,u=s.rules,d=s.eachConfig,v=t.state,m=v.required,h=v.requiredMsg,b=v.value,V=v.visible;if(l&&!m||!V)return!0;var y=t.validateEmpty(b);if(m&&y)return k(h)?!1:[h];if(y)return!0;var U={val:t.value};d&&Object.assign(U,d);var F=function(I){if(I&&I instanceof RegExp)return I.test(b);if(q(I))return I(i.data,U);if(S(I)){var G=I.pattern,pe=I.message;if(G&&!G.test(b))return pe||!1}return!0};if(D(u)){var C=[],R=!0;return u.forEach(function(A){var I=F(A);_(I)||a&&Ie(I)?C.push(I):I||(R=!1)}),C.length?C:R}else if(S(u)){var T=F(u);return _(T)?[T]:T}return!0}},{key:"validateEmpty",value:function(e){var t=this.props.label,r=function(i){return le(i)||!!(t&&k(i[t]))};return L(e)?!0:_(e)?k(e):S(e)?r(e):D(e)?ee(e)||S(e[0])&&r(e[0]):L(e)}},{key:"listenerValueChange",value:function(e){var t=this,r=this.context,a=t.props.listener;t.handleValue(a!=null&&a.convertValue?a.convertValue(e,r.data):e)}},{key:"componentDidMount",value:function(){var e,t=this,r=t.context,a=t.props.listener,i=a===void 0?{}:a,s=i.key;s&&((e=r.emitter)===null||e===void 0||e.addListener(s,t.listenerValueChange)),r.formInstance.setField(t)}},{key:"componentWillUnmount",value:function(){var e,t=this;t.unmount=!0;var r=t.context,a=t.props.listener,i=a===void 0?{}:a,s=i.key;s&&((e=r.emitter)===null||e===void 0||e.removeListener(s,t.listenerValueChange)),r.formInstance.unmountField(t)}},{key:"shouldComponentUpdate",value:function(e,t){var r=this,a=r.props,i=r.state,s=function(){var u=e.shouldUpdate,d=a.shouldUpdate;return D(u)&&D(d)?u.some(function(v,m){return v!==d[m]}):u!==d};return t.value!==i.value||t.required!==i.required||t.error!==i.error||t.visible!==i.visible||t.disabled!==i.disabled||t._refreshMark!==i._refreshMark||e.form!==a.form||r.getFormName(e)!==r.getFormName(a)||s()}},{key:"getSnapshotBeforeUpdate",value:function(e,t){var r=this,a=this.context,i=r.getFormName(r.props),s=r.getFormName(e);return e.form!==this.props.form&&a.formInstance.unmountField(this),i!==s&&!k(i)&&a.formInstance.renameField(i,r),null}},{key:"componentDidUpdate",value:function(e,t){var r=this,a=this.context,i=r.state,s=i.value,l=i.required,u=r.getFormName(r.props);if(s!==t.value){var d,v;a.formInstance.fieldChange(u,s,{raw:!r.changeForm}),r.changeFlag&&((d=(v=r.props).onChange)===null||d===void 0||d.call(v,s))}(s!==t.value&&r.changeFlag||l!==t.required&&!l)&&r.asyncValidateErrors(),e.form!==r.props.form&&a.formInstance.setField(r),u!==r.getFormName(e)&&a.formInstance.fieldChange(u,s,{raw:!0}),r.changeFlag=!1,r.changeForm=!1}},{key:"render",value:function(){var e=this,t=e.context,r=e.state,a=r.value,i=r.required,s=r.error,l=r.errors,u=r.disabled,d=r.visible,v=e.props,m=v.forwardRef,h=v.__Component__,b=v.preserve,V=v.title,y=v.valuePropName,U=v.forValue,F=v.parentField,C=v.deliver,R=Ve()(v,ut);if(!d&&!b)return null;var T=U?U(a,t.data):a;y&&(R[y]=T);var A=e.providerValue;A.visible=d;var I=(0,x.jsx)(h,N()(N()({},R),{},{title:e.getTitle(),data:t.data,value:T,required:i,disabled:t.disabled||u,visible:d,formInstance:e.formInstance,error:s,errors:l,onChange:e.onChange,ref:m}));return C?(0,x.jsx)(Oe.Provider,{value:A,children:I}):I}}],[{key:"getDerivedStateFromProps",value:function(e,t){var r=null;function a(i){var s=e[i];!B(s)&&s!==t["_".concat(i)]&&(r=r||{},r[i]=s,r["_".concat(i)]=s)}return["value"].forEach(a),r}}]),f}(E.Component);g()(ce,"contextType",$.Context),g()(ce,"defaultProps",{inline:Le,unique:$e,deliver:lt,injectListName:Se,preserve:!1});function xe(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=o.defaultValue;return function(f){return function(n){return(0,x.jsx)(J.Consumer,{children:function(t){var r=t,a=n.initialValue,i=n.form,s=n.inline,l=s===void 0?Le:s,u=n.injectListName,d=u===void 0?Se:u;if(r&&d){var v=r.data[r.index];a=i?S(v)&&i in v?v[i]:l?a:v:B(v)?a:v}return(0,x.jsx)(Oe.Consumer,{children:function(h){return(0,x.jsx)(ce,N()(N()({defaultValue:c},n),{},{parentField:h,initialValue:a,eachConfig:r,__Component__:f}))}})}})}}}var te=function(c){var f=c.children,n=(0,E.useContext)(Z);if(!n||!f)return null;var e=n.keys,t=n.form,r=n.listInstance;return(0,x.jsx)(x.Fragment,{children:e.map(function(a,i){var s=N()(N()({},n),{},{form:k(t)?String(i):"".concat(t,".").concat(i),index:i,key:a,remove:r.removeItem.bind(r,i),add:r.addItem.bind(r),move:r.moveItem.bind(r)});return(0,x.jsx)(J.Provider,{value:s,children:f(s)},a)})})},he=function(o){ne()(f,o);var c=ie()(f);function f(n,e){var t;re()(this,f),t=c.call(this,n,e),g()(O()(t),"deleteIndex",[]),g()(O()(t),"uuid",0),g()(O()(t),"fieldType",X.List);var r=O()(t),a=n.formList;return r.genID=r.genID.bind(r),r.addItem=r.addItem.bind(r),r.removeItem=r.removeItem.bind(r),r.moveItem=r.moveItem.bind(r),r.state=r.initState(),a&&a.__REF__&&(a.__REF__.current=r),t}return ae()(f,[{key:"initState",value:function(){var e=this,t=e.props,r=e.context;e._initID();var a=t.initRows,i=t.initialValue,s=e.getFormName(t);r&&r.initialValue&&(k(s)?D(r.initialValue)&&(i=r.initialValue):i=H(r.initialValue,s,i));var l=Array(a),u=i;D(i)&&u.length&&(a=u.length,l=u);var d=Array(a).fill(1).map(e.genID);return{keys:d,data:l}}},{key:"_initID",value:function(){this.uuid=1e3}},{key:"genID",value:function(){return"CC".concat(++this.uuid)}},{key:"getFormName",value:function(e){var t=e.form,r=e.eachConfig;return r?t?"".concat(r.form,".").concat(t):r.form:t}},{key:"setData",value:function(e){var t=this,r=t.props.initRows,a=t.state.keys;L(e)||!D(e)?e=[]:e.length===0&&(e=Array(r)),t.removeOutData(e.length),a=a.slice(0,e.length),t.setState({keys:a,data:e})}},{key:"getData",value:function(){return this.state.data}},{key:"addItem",value:function(e,t){var r,a=this,i=a.genID(),s=a.state,l=s.data,u=s.keys;u=Array.from(u),!L(t)&&t<l.length?(u.splice(t,0,i),l.splice(t,0,e),a.removeListData(t,1)):(u.push(i),l.push(e)),a.setState({keys:u,data:l}),(r=a.context)===null||r===void 0||r.formInstance.formChange()}},{key:"removeItem",value:function(e){var t=this,r=t.state,a=r.data,i=r.keys,s=i.length,l=(D(e)?e:[e]).filter(function(d){return d<s});if(l.length){var u;(u=t.deleteIndex).push.apply(u,ke()(l)),t.removeListData(s-l.length,l.length),i=Array.from(i),l.forEach(function(d,v){i.splice(d-v,1),a.splice(d-v,1)}),t.setState({keys:i,data:a})}}},{key:"moveItem",value:function(e,t){var r=this,a=r.state,i=a.data,s=a.keys;if(e!==t&&e>=0&&e<s.length&&t>=0&&t<s.length){var l;s=Array.from(s);var u=s[e],d=i[e];s.splice(e,1),s.splice(t,0,u),i.splice(e,1),i.splice(t,0,d),r.setState({keys:s,data:i}),(l=r.context)===null||l===void 0||l.formInstance.formChange()}}},{key:"removeListData",value:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=this,a=r.getFormName(r.props),i=r.context,s=i.data,l=i.formInstance,u=e+t,d=[],v=e;v<u;v++)d.push(a?"".concat(a,".").concat(v):String(v));var m=function(V){d.forEach(function(y){V.indexOf(y)===0&&l.deleteField(V)})};for(var h in s)m(h)}},{key:"removeOutData",value:function(e){var t=this,r=t.getFormName(t.props),a=t.context,i=a.data,s=a.formInstance,l=r?Array(e).fill(1).map(function(u,d){return"".concat(r,".").concat(d)}):[];Object.keys(i).forEach(function(u){if(k(r)){var d=Number(u),v=u.substr(0,u.indexOf("."));String(d)===u&&d<e?s.deleteField(u,{isChange:!1}):/^[0-9]+$/.test(v)&&Number(v)>=e&&s.deleteField(u,{isChange:!1})}else u.indexOf(String(r))===0&&l.findIndex(function(m){return u.indexOf(m)!==-1})===-1&&s.deleteField(u,{isChange:!1})})}},{key:"getConfig",value:function(){return{form:this.getFormName(this.props)}}},{key:"componentDidMount",value:function(){var e;(e=this.context)===null||e===void 0||e.formInstance.setField(this)}},{key:"componentWillUnmount",value:function(){var e;(e=this.context)===null||e===void 0||e.formInstance.unmountField(this)}},{key:"shouldComponentUpdate",value:function(e,t){var r=this,a=r.props,i=r.state;return e.form!==a.form||t.keys!==i.keys||r.getFormName(e)!==r.getFormName(a)}},{key:"componentDidUpdate",value:function(e,t,r){if(t.keys!==this.state.keys){var a;(a=this.context)===null||a===void 0||a.formInstance.observeField()}}},{key:"render",value:function(){var e=this,t=e.context,r=e.getFormName(e.props),a=e.props.children,i=e.state,s=i.keys,l=i.data;if(!a||!D(s))return null;var u={form:r,listInstance:e,keys:s,data:l,length:s.length,formData:t.data},d=q(a)?(0,x.jsx)(te,{children:a}):a;return(0,x.jsx)(Z.Provider,{value:u,children:d})}}]),f}(E.Component);g()(he,"contextType",$.Context),g()(he,"defaultProps",{initRows:1});var me=function(c){var f=(0,E.useContext)(J),n=c.form,e=c.initialValue,t=c.children,r=f;if(r){var a=r.data[r.index];e=n?S(a)&&n in a?a[n]:e:a}return(0,x.jsx)(he,N()(N()({},c),{},{initialValue:e,eachConfig:r,children:t}))};me.View=te;var Ue=function(c){var f=c.children,n=(0,E.useContext)(Z);if(!n)return null;var e=n.listInstance,t=N()(N()({},n),{},{remove:e.removeItem,add:e.addItem,move:e.moveItem});return(0,x.jsx)(x.Fragment,{children:f(t)})},vt=["children","forProps"];function ge(){return function(o){return(0,E.forwardRef)(function(c,f){return(0,x.jsx)(J.Consumer,{children:function(e){return(0,x.jsx)($.Context.Consumer,{children:function(r){return(0,x.jsx)(o,N()(N()(N()({},c),{},{ref:f},r),{},{eachConfig:e||void 0}))}})}})})}}var Re=ge()(function(o){var c=o.children,f=o.forProps,n=Ve()(o,vt);return(0,E.cloneElement)(c,f?f(n):n)});$.List=me,$.ListView=te,$.Field=xe,$.Outlet=ge,$.OutletView=Re,$.ListAction=Ue}}]);
